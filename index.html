<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>北平风物记 | 沉浸式文化漫游指南</title>
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        /* --- 新增：沉浸式白噪音按钮 --- */
.audio-wrapper {
    margin-top: 15px;
    display: flex;
    justify-content: center;
    align-items: center;
}

.ambient-btn {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 20px;
    background: rgba(255, 255, 255, 0.6);
    border: 1px solid var(--c-gray);
    border-radius: 50px;
    cursor: pointer;
    font-family: var(--f-body);
    font-size: 0.9rem;
    color: var(--c-ink);
    transition: all 0.3s ease;
    backdrop-filter: blur(5px);
}

.ambient-btn:hover {
    background: #fff;
    border-color: var(--c-red);
    color: var(--c-red);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
}

/* 播放状态 */
.ambient-btn.playing {
    background: var(--c-ink);
    border-color: var(--c-ink);
    color: var(--c-paper);
}

.ambient-btn.playing:hover {
    background: var(--c-red);
    border-color: var(--c-red);
}

/* 简单的声波动画图标 */
.sound-wave {
    display: flex;
    align-items: center;
    gap: 3px;
    height: 12px;
}

.bar {
    width: 2px;
    height: 100%;
    background-color: currentColor;
    animation: none;
}

.ambient-btn.playing .bar {
    animation: wave 1s infinite ease-in-out;
}

.ambient-btn.playing .bar:nth-child(1) { animation-delay: 0.0s; }
.ambient-btn.playing .bar:nth-child(2) { animation-delay: 0.2s; }
.ambient-btn.playing .bar:nth-child(3) { animation-delay: 0.4s; }
.ambient-btn.playing .bar:nth-child(4) { animation-delay: 0.1s; }

@keyframes wave {
    0%, 100% { height: 20%; }
    50% { height: 100%; }
}
        :root {
            --c-red: #8E354A;       /* 宫墙红 */
            --c-ink: #2C2C2C;       /* 徽墨 */
            --c-gray: #5e616d;      /* 瓦灰 */
            --c-paper: #F3F1E8;     /* 宣纸白 */
            --c-gold: #B59868;      /* 鎏金 */
            
            --f-title: 'Ma Shan Zheng', cursive;
            --f-body: 'Noto Serif SC', serif;
            
            --nav-height: 80px;
        }

        /* 夜间模式变量 */
        [data-theme="dark"] {
            --c-red: #B84A62;       /* 宫墙红（亮） */
            --c-ink: #E8E6DC;       /* 宣纸白 */
            --c-gray: #A8AAAD;      /* 浅灰 */
            --c-paper: #1A1A1A;     /* 深墨色 */
            --c-gold: #D4B078;      /* 鎏金（亮） */
        }

        /* 夜间模式切换按钮样式 */
        .theme-toggle {
            transition: transform 0.3s ease, color 0.3s ease;
        }

        .theme-toggle:hover {
            transform: rotate(15deg);
            color: var(--c-red) !important;
        }

        [data-theme="dark"] .theme-toggle {
            color: var(--c-gold) !important;
        }

        /* 夜间模式下的背景调整 */
        [data-theme="dark"] body {
            background-color: var(--c-paper);
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.1' fill='%23ffffff'/%3E%3C/svg%3E");
        }

        /* 夜间模式下的卡片和容器调整 */
        [data-theme="dark"] .route-card,
        [data-theme="dark"] .concept-card,
        [data-theme="dark"] .memory-item,
        [data-theme="dark"] .voice-guide,
        [data-theme="dark"] .virtual-tour,
        [data-theme="dark"] .stamp-item,
        [data-theme="dark"] .user-reviews,
        [data-theme="dark"] .transport-guide {
            background: rgba(30, 30, 30, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* 夜间模式下的导航栏调整 */
        [data-theme="dark"] nav {
            background: rgba(26, 26, 26, 0.95);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* 夜间模式下的下拉菜单调整 */
        [data-theme="dark"] .dropdown {
            background: rgba(30, 30, 30, 0.98);
            border-top: 3px solid var(--c-red);
        }

        [data-theme="dark"] .dropdown a {
            color: var(--c-gray);
        }

        [data-theme="dark"] .dropdown a:hover {
            background: rgba(40, 40, 40, 0.8);
        }

        /* 夜间模式下的按钮调整 */
        [data-theme="dark"] .action-btn,
        [data-theme="dark"] .voice-btn {
            background: rgba(40, 40, 40, 0.8);
            border-color: rgba(255, 255, 255, 0.2);
            color: var(--c-ink);
        }

        [data-theme="dark"] .view-btn {
            background: var(--c-red);
        }

        /* 夜间模式下的AI聊天框调整 */
        [data-theme="dark"] #ai-chat {
            background: rgba(30, 30, 30, 0.98);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        [data-theme="dark"] #chat-input {
            background: rgba(40, 40, 40, 0.8);
            border-color: rgba(255, 255, 255, 0.2);
            color: var(--c-ink);
        }

        [data-theme="dark"] #chat-messages > div {
            background: rgba(40, 40, 40, 0.8);
        }

        /* 夜间模式下的文本输入框调整 */
        [data-theme="dark"] input {
            background: rgba(40, 40, 40, 0.8);
            border-color: rgba(255, 255, 255, 0.2);
            color: var(--c-ink);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            background-color: var(--c-paper);
            color: var(--c-ink);
            font-family: var(--f-body);
            overflow-x: hidden;
            /* 纸张纹理 */
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
        }

        /* --- 【核心修改】单独设立的图片类 --- */
        .project-img {
            width: 100%;
            height: 500px;          /* 统一高度，保持整齐 */
            object-fit: cover;      /* 智能裁剪，防止变形 */
            border-radius: 4px;     /* 微圆角 */
            box-shadow: 20px 20px 0px rgba(0,0,0,0.05); /* 新中式阴影 */
            transition: transform 0.8s ease, filter 0.5s ease;
            filter: sepia(0.1);     /* 轻微复古滤镜 */
        }

        /* 鼠标悬停时的图片动效 */
        .article-block:hover .project-img {
            transform: scale(1.02);
            filter: sepia(0);image/
        }

        /* --- 0. 开场动画 --- */
        #intro-overlay {
            position: fixed; inset: 0; z-index: 9999;
            /* 使用beijing图片作为底图 */
            background: url('image/beijing.jpg') center/cover no-repeat;
            color: var(--c-paper);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 1s ease, visibility 1s;
        }
        #intro-overlay::after {
            content: ''; position: absolute; inset: 0;
            background: rgba(0, 0, 0, 0.5); /* 添加半透明黑色遮罩，增强文字可读性 */
            pointer-events: none; /* 允许点击事件穿透到下面的元素 */
        }
        .intro-text { font-family: var(--f-title); font-size: 3.5rem; writing-mode: vertical-rl; letter-spacing: 0.5rem; margin-bottom: 40px; position: relative; z-index: 1; }
        .btn-enter { padding: 12px 40px; border: 1px solid var(--c-paper); background: transparent; color: var(--c-paper); cursor: pointer; font-family: var(--f-body); letter-spacing: 2px; transition: 0.4s; font-size: 1.1rem; position: relative; z-index: 1; }
        .btn-enter:hover { background: var(--c-paper); color: var(--c-ink); box-shadow: 0 0 20px rgba(255,255,255,0.3); }

        /* --- 1. 导航栏 --- */
        nav {
            position: fixed; top: 0; width: 100%; height: var(--nav-height);
            background: rgba(243, 241, 232, 0.95); backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0,0,0,0.05); z-index: 1000;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 40px; transition: all 0.3s;
        }
        .logo { font-family: var(--f-title); font-size: 2rem; color: var(--c-red); text-decoration: none; }
        .menu { display: flex; gap: 40px; height: 100%; align-items: center; }
        .menu-item { position: relative; height: 100%; display: flex; align-items: center; cursor: pointer; font-size: 1rem; color: var(--c-ink); text-decoration: none; transition: 0.3s; }
        .menu-item:hover { color: var(--c-red); }
        
        /* 二级菜单 */
        .dropdown {
            position: absolute; top: var(--nav-height); left: 50%; transform: translateX(-50%);
            background: #fff; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 20px 0; min-width: 180px; opacity: 0; visibility: hidden;
            transition: all 0.3s ease; border-top: 3px solid var(--c-red);
        }
        .menu-item:hover .dropdown { opacity: 1; visibility: visible; top: var(--nav-height); }
        .dropdown a { display: block; padding: 12px 30px; color: #666; text-decoration: none; font-size: 0.95rem; transition: 0.2s; white-space: nowrap; }
        .dropdown a:hover { background: var(--c-paper); color: var(--c-red); padding-left: 35px; }

        /* --- 2. Hero 封面 (背景图) --- */
        header {
            height: 100vh; position: relative; display: flex; align-items: center; justify-content: center;
            /* 修改：使用本地图片 shouye.png */
            background: url('image/shouye.png') center/cover no-repeat;
        }
        header::after { content: ''; position: absolute; inset: 0; background: linear-gradient(to bottom, rgba(0,0,0,0.2), rgba(243, 241, 232, 1)); }
        .hero-content { position: relative; z-index: 10; text-align: center; }
        .hero-title { font-size: 5rem; writing-mode: vertical-lr; color: #fff; text-shadow: 0 4px 20px rgba(0,0,0,0.5); letter-spacing: 1rem; border-left: 4px solid var(--c-red); padding-left: 30px; margin-left: -30px; }

        /* --- 3. 交互地图 (背景图) --- */
        #map-section { padding: 100px 0; background: #e8e6dc; position: relative; overflow: hidden; }
        .map-container {
            width: 100%; height: 80vh; max-width: 1200px; margin: 0 auto;
            position: relative;
            /* 修改：使用本地图片 ditu.png */
            background: url('image/ditu.png') center/cover no-repeat;
            border-radius: 4px; box-shadow: 0 20px 50px rgba(0,0,0,0.1);
        }
        .map-title { position: absolute; top: 40px; left: 40px; font-family: var(--f-title); font-size: 3rem; color: #fff; text-shadow: 0 2px 10px rgba(0,0,0,0.5); z-index: 20; }
        
        /* 地图标记点 */
        .pin {
            position: absolute; width: 24px; height: 24px; background: var(--c-red);
            border: 3px solid #fff; border-radius: 50%; cursor: pointer; z-index: 10;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); transition: transform 0.3s;
        }
        .pin:hover { transform: scale(1.3); }
        .pin::after { content: ''; position: absolute; inset: -10px; border: 2px solid var(--c-red); border-radius: 50%; animation: pulse 2s infinite; opacity: 0; }
        
        .map-card {
            position: absolute; bottom: 40px; left: 40px; width: 300px; background: rgba(255,255,255,0.95);
            padding: 25px; border-left: 5px solid var(--c-red); opacity: 0; transform: translateY(20px);
            transition: all 0.4s ease; pointer-events: none; backdrop-filter: blur(5px);
        }
        .map-card.active { opacity: 1; transform: translateY(0); pointer-events: auto; }

        /* --- 4. 路线布局 --- */
        .route-container { max-width: 1000px; margin: 150px auto; padding: 0 24px; }
        .route-header { text-align: center; margin-bottom: 80px; position: relative; }
        .route-header h2 { font-size: 3.5rem; color: var(--c-red); margin-bottom: 10px; }
        .route-header span { font-size: 1rem; letter-spacing: 4px; color: var(--c-gray); text-transform: uppercase; }
        
        .article-block { display: grid; grid-template-columns: 1fr 1fr; gap: 60px; margin-bottom: 100px; align-items: center; }
        .article-block.reverse { direction: rtl; }
        .article-block.reverse .text-wrap { direction: ltr; }
        
        .text-wrap h3 { font-size: 1.8rem; margin-bottom: 20px; color: var(--c-ink); border-left: 4px solid var(--c-gold); padding-left: 15px; }
        .text-wrap p { line-height: 1.8; margin-bottom: 20px; text-align: justify; font-size: 1.05rem; }
        .text-wrap .drop-cap { float: left; font-size: 3.5rem; line-height: 0.8; padding-right: 10px; color: var(--c-red); font-family: var(--f-title); }
        
        .img-wrap { overflow: hidden; border-radius: 4px; } /* 包裹层 */

        /* --- 任务卡 --- */
        .task-box {
            background: #222; color: #f3f1e8; padding: 40px; margin: 60px 0;
            text-align: center; border: 1px solid var(--c-gold); position: relative;
            background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='2' cy='2' r='1' fill='%23B59868' fill-opacity='0.2'/%3E%3C/svg%3E");
        }
        .task-title { color: var(--c-gold); font-family: var(--f-title); font-size: 1.5rem; margin-bottom: 20px; }
        .task-content { font-size: 1.2rem; min-height: 60px; display: flex; align-items: center; justify-content: center; font-style: italic; transition: opacity 0.3s; }
        .btn-task { margin-top: 20px; padding: 10px 30px; background: var(--c-red); border: none; color: white; cursor: pointer; font-family: var(--f-body); font-size: 1rem; }
        .btn-task:hover { background: #fff; color: var(--c-red); }

        /* --- 新增：关于我们 / 品牌理念板块 --- */
#about {
    padding: 120px 0;
    background: rgba(255, 255, 255, 0.4); /* 轻微透白，区别于背景 */
    position: relative;
    border-top: 1px solid rgba(0,0,0,0.05);
    border-bottom: 1px solid rgba(0,0,0,0.05);
}

.about-container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 0 40px;
}

.about-header {
    text-align: center;
    margin-bottom: 60px;
}

.about-header h2 {
    font-family: var(--f-title);
    font-size: 3rem;
    color: var(--c-ink);
    margin-bottom: 15px;
}

.about-header .sub-title {
    color: var(--c-red);
    letter-spacing: 4px;
    font-size: 0.9rem;
    text-transform: uppercase;
}

.concept-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 60px;
}

.concept-card {
    padding: 40px;
    background: #fff;
    border: 1px solid rgba(0,0,0,0.05);
    box-shadow: 10px 10px 30px rgba(0,0,0,0.03);
    border-radius: 4px;
    transition: transform 0.3s ease;
    position: relative;
    overflow: hidden;
}

.concept-card:hover {
    transform: translateY(-5px);
    box-shadow: 15px 15px 40px rgba(0,0,0,0.06);
}

/* 装饰性边框，增加中式韵味 */
.concept-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; width: 100%; height: 4px;
    background: var(--c-gold);
    opacity: 0.5;
}

.concept-title {
    font-size: 1.4rem;
    color: var(--c-ink);
    margin-bottom: 25px;
    font-weight: bold;
    display: flex;
    align-items: center;
    gap: 10px;
}

.concept-title span {
    color: var(--c-red);
    font-family: var(--f-title);
    font-size: 1.8rem;
}

.concept-text {
    line-height: 1.8;
    color: #555;
    font-size: 1rem;
    text-align: justify;
}

.highlight-box {
    margin-top: 20px;
    padding: 15px;
    background: var(--c-paper);
    border-left: 3px solid var(--c-red);
    font-size: 0.9rem;
    color: var(--c-gray);
    font-style: italic;
}

@media (max-width: 768px) {
    .concept-grid { grid-template-columns: 1fr; }
    .about-header h2 { font-size: 2.5rem; }
}

        /* Footer */
        footer { background: var(--c-ink); color: #888; padding: 80px 0; text-align: center; }
        .share-btn { padding: 15px 50px; background: transparent; border: 1px solid #666; color: #fff; font-size: 1rem; cursor: pointer; transition: 0.3s; }
        .share-btn:hover { background: var(--c-gold); border-color: var(--c-gold); color: #000; }

        /* 路线策展相关样式 */
        .routes-section {
            padding: 120px 0 80px;
            text-align: center;
        }
        
        /* 城市记忆交互 */
        .city-memory {
            display: block;
        }
        
        .route-details-section {
            display: none;
            margin-top: 60px;
        }
        
        .route-details-section.active {
            display: block;
        }
        
        .back-btn {
            display: inline-block;
            background: var(--c-paper);
            color: var(--c-ink);
            padding: 10px 25px;
            border-radius: 4px;
            text-decoration: none;
            transition: all 0.3s ease;
            margin-bottom: 30px;
            border: 1px solid #e0ded6;
        }
        
        .back-btn:hover {
            background: var(--c-gray);
            color: white;
        }
        
        /* 记忆卡片悬停效果增强 */
        .memory-item {
            transition: all 0.3s ease;
        }
        
        .memory-item:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        /* 集章游戏样式 */
        .stamp-section {
            margin: 80px 0;
            padding: 60px 0;
            background: var(--c-paper);
        }
        
        .stamp-title {
            font-family: var(--f-title);
            font-size: 2.5rem;
            color: var(--c-red);
            margin-bottom: 40px;
            text-align: center;
        }
        
        .stamps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 30px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .stamp-item {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        
        .stamp-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }
        
        .stamp-image {
            width: 100px;
            height: 100px;
            margin: 0 auto 15px;
            background: #f0f0f0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: #ccc;
            transition: all 0.3s ease;
        }
        
        .stamp-item.collected .stamp-image {
            background: linear-gradient(135deg, var(--c-red), var(--c-gold));
            color: white;
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(142, 53, 74, 0.3);
        }
        
        .stamp-name {
            font-size: 1rem;
            color: var(--c-ink);
            margin-bottom: 5px;
        }
        
        .stamp-status {
            font-size: 0.9rem;
            color: var(--c-gray);
        }
        
        .stamp-item.collected .stamp-status {
            color: var(--c-red);
            font-weight: bold;
        }
        
        .stamp-progress {
            text-align: center;
            margin: 40px 0;
            font-size: 1.2rem;
            color: var(--c-ink);
        }
        
        .progress-bar {
            width: 80%;
            max-width: 600px;
            height: 20px;
            background: #e0ded6;
            border-radius: 10px;
            margin: 20px auto;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--c-red), var(--c-gold));
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }
        
        .collect-all-btn {
            display: inline-block;
            background: var(--c-red);
            color: white;
            padding: 12px 40px;
            border-radius: 4px;
            text-decoration: none;
            transition: all 0.3s ease;
            margin-top: 20px;
            border: none;
            font-family: var(--f-body);
            font-size: 1rem;
            cursor: pointer;
        }
        
        .collect-all-btn:hover {
            background: var(--c-gold);
            transform: translateY(-2px);
        }
        
        /* AI语音导游样式 */
        .voice-guide {
            margin: 40px 0;
            padding: 30px;
            background: var(--c-paper);
            border-radius: 8px;
            border: 1px solid #e0ded6;
        }
        
        .voice-guide-title {
            font-size: 1.2rem;
            color: var(--c-ink);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .voice-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .voice-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: white;
            border: 1px solid #e0ded6;
            border-radius: 50px;
            cursor: pointer;
            font-family: var(--f-body);
            font-size: 0.9rem;
            color: var(--c-ink);
            transition: all 0.3s ease;
        }
        
        .voice-btn:hover {
            background: var(--c-red);
            color: white;
            border-color: var(--c-red);
        }
        
        .voice-btn.active {
            background: var(--c-red);
            color: white;
            border-color: var(--c-red);
        }
        
        .voice-slider {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .voice-slider label {
            font-size: 0.9rem;
            color: var(--c-gray);
        }
        
        .voice-slider input[type="range"] {
            width: 150px;
            accent-color: var(--c-red);
        }
        
        .voice-status {
            margin-top: 15px;
            font-size: 0.9rem;
            color: var(--c-gray);
        }
        
        /* 语音播放动画 */
        .voice-wave {
            display: flex;
            align-items: center;
            gap: 3px;
            height: 12px;
        }
        
        .voice-bar {
            width: 2px;
            height: 100%;
            background-color: currentColor;
            animation: none;
        }
        
        .voice-btn.playing .voice-bar {
            animation: voiceWave 1s infinite ease-in-out;
        }
        
        .voice-btn.playing .voice-bar:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .voice-btn.playing .voice-bar:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        .voice-btn.playing .voice-bar:nth-child(4) {
            animation-delay: 0.1s;
        }
        
        @keyframes voiceWave {
            0%, 100% { height: 20%; }
            50% { height: 100%; }
        }
        
        /* 虚拟漫游样式 */
        .virtual-tour {
            margin: 40px 0;
            padding: 30px;
            background: var(--c-paper);
            border-radius: 8px;
            border: 1px solid #e0ded6;
        }
        
        .virtual-tour-title {
            font-size: 1.2rem;
            color: var(--c-ink);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .panorama-container {
            position: relative;
            width: 100%;
            height: 400px;
            background: #f0f0f0;
            border-radius: 8px;
            overflow: hidden;
            cursor: grab;
        }
        
        .panorama-container:active {
            cursor: grabbing;
        }
        
        .panorama-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 200%; /* 2倍宽度实现全景效果 */
            height: 100%;
            background-size: cover;
            background-position: center;
            transition: transform 0.1s ease;
        }
        
        .panorama-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            background: rgba(0, 0, 0, 0.6);
            padding: 10px 20px;
            border-radius: 30px;
            z-index: 10;
        }
        
        .panorama-btn {
            background: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .panorama-btn:hover {
            background: var(--c-red);
            color: white;
            transform: scale(1.1);
        }
        
        .hotspot {
            position: absolute;
            width: 22px;
            height: 22px;
            background: radial-gradient(circle, var(--c-red), #6B1E2A);
            border: 3px solid white;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 5;
            animation: pulse 2s infinite;
            box-shadow: 0 0 10px rgba(142, 53, 74, 0.5);
        }
        
        .hotspot:hover {
            transform: scale(1.4);
            box-shadow: 0 0 25px var(--c-red), 0 0 40px rgba(142, 53, 74, 0.4);
            animation: none;
        }
        
        .hotspot::after {
            content: attr(data-label);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.8));
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            margin-bottom: 10px;
            font-weight: 500;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .hotspot:hover::after {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(-5px);
        }
        
        /* 热点标记动画增强 */
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(142, 53, 74, 0.7);
            }
            70% {
                box-shadow: 0 0 0 15px rgba(142, 53, 74, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(142, 53, 74, 0);
            }
        }
        
        /* 热点信息面板增强 */
        .hotspot-info {
            background: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(10px);
            border-radius: 10px !important;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15) !important;
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
            transition: all 0.3s ease !important;
        }
        
        .hotspot-info.active {
            animation: slideInRight 0.3s ease;
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        /* 全景容器增强 */
        .panorama-container {
            border-radius: 12px !important;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15) !important;
            transition: all 0.3s ease;
            background: #f5f5f5;
        }
        
        /* 全景图片增强 */
        .panorama-image {
            transition: transform 0.2s ease !important;
        }
        
        /* 全景控制按钮增强 */
        .panorama-controls {
            background: rgba(0, 0, 0, 0.85) !important;
            backdrop-filter: blur(10px);
            border-radius: 40px !important;
            padding: 12px 20px !important;
            gap: 15px !important;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3) !important;
        }
        
        .panorama-btn {
            background: rgba(255, 255, 255, 0.9) !important;
            border-radius: 50% !important;
            width: 45px !important;
            height: 45px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            cursor: pointer !important;
            border: 2px solid transparent !important;
            transition: all 0.3s ease !important;
            color: var(--c-ink);
            font-size: 1rem;
        }
        
        .panorama-btn:hover {
            background: var(--c-red) !important;
            color: white !important;
            transform: scale(1.15) !important;
            border-color: var(--c-red) !important;
            box-shadow: 0 5px 15px rgba(142, 53, 74, 0.4) !important;
        }
        
        /* 虚拟漫游标题增强 */
        .virtual-tour-title {
            font-weight: bold;
            margin-bottom: 25px !important;
            color: var(--c-red);
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.3rem;
        }
        
        /* 虚拟漫游容器增强 */
        .virtual-tour {
            margin: 50px 0 !important;
            padding: 35px !important;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.8), rgba(243, 241, 232, 0.9)) !important;
            border-radius: 12px !important;
            border: 1px solid rgba(0, 0, 0, 0.05) !important;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05) !important;
        }
        
        .hotspot-info {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 8px;
            max-width: 300px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 15;
            display: none;
        }
        
        .hotspot-info.active {
            display: block;
        }
        
        .hotspot-info h4 {
            color: var(--c-red);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .hotspot-info p {
            color: var(--c-ink);
            font-size: 0.9rem;
            line-height: 1.6;
        }
        
        /* 路线详情相关样式 */
        .route-details-section {
            display: none;
            margin-top: 60px;
        }
        
        .route-details-section.active {
            display: block;
        }
        
        .route-card {
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }
        
        .route-image {
            height: 250px;
            background-size: cover;
            background-position: center;
            position: relative;
            overflow: hidden;
        }
        
        /* 使用本地图片 */
        #literature-details .route-image {
            background-image: url('image/wenxue.jpg');
        }

        #jiangnan-details .route-image {
            background-image: url('image/jiangnan.jpg');
        }

        #ditan-details .route-image {
            background-image: url('image/ditan.jpg');
        }
        
        /* 路线卡片悬停效果增强 */
        .route-card:hover .route-image {
            transform: scale(1.05);
            transition: transform 0.5s ease;
        }
        
        /* 添加路线评分系统 */
        .route-rating {
            margin: 20px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stars {
            display: flex;
            gap: 5px;
        }
        
        .star {
            font-size: 1.2rem;
            color: var(--c-gold);
        }
        
        /* 添加路线难度标识 */
        .route-difficulty {
            display: inline-block;
            padding: 5px 12px;
            background: var(--c-paper);
            border-radius: 15px;
            font-size: 0.85rem;
            margin-left: 10px;
        }
        
        /* 添加季节推荐标签 */
        .season-tags {
            margin: 20px 0;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .season-tag {
            padding: 6px 12px;
            background: var(--c-paper);
            border-radius: 12px;
            font-size: 0.8rem;
            color: var(--c-gray);
        }
        
        /* 添加用户评价卡片 */
        .user-reviews {
            margin: 40px 0;
            padding: 20px;
            background: var(--c-paper);
            border-radius: 8px;
        }
        
        .reviews-title {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: var(--c-ink);
        }
        
        .review-item {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        
        .review-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .review-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--c-red);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .review-content {
            flex: 1;
        }
        
        .review-author {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .review-text {
            font-size: 0.9rem;
            color: var(--c-gray);
        }
        
        /* 路线编号 */
        .route-number {
            position: absolute;
            top: 20px;
            left: 20px;
            background: var(--c-red);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        /* 路线内容 */
        .route-content {
            padding: 30px;
        }
        
        .route-title {
            font-size: 1.8rem;
            color: var(--c-ink);
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .route-subtitle {
            font-size: 1rem;
            color: var(--c-gray);
            margin-bottom: 20px;
        }
        
        .route-duration {
            display: inline-block;
            background: var(--c-gold);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }
        
        .route-description {
            color: #666;
            margin-bottom: 25px;
            line-height: 1.7;
        }
        
        .route-highlights {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 25px;
        }
        
        .highlight-tag {
            background: var(--c-paper);
            color: var(--c-ink);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            border: 1px solid #e0ded6;
        }
        
        /* 查看按钮 */
        .view-btn {
            display: inline-block;
            background: var(--c-red);
            color: white;
            padding: 12px 30px;
            border-radius: 4px;
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: bold;
            font-family: var(--f-body);
            font-size: 1rem;
            border: none;
            cursor: pointer;
        }
        
        .view-btn:hover {
            background: #732a3c;
            transform: translateY(-2px);
        }
        
        /* 动画 */
        @keyframes pulse { 0% { opacity: 0.8; transform: scale(1); } 100% { opacity: 0; transform: scale(3); } }
        .reveal { opacity: 0; transform: translateY(30px); transition: all 0.8s ease; }
        .reveal.active { opacity: 1; transform: translateY(0); }
        
        /* 滚动动画增强 */
        .scroll-fade-in {
            opacity: 0;
            transform: translateY(50px);
            transition: opacity 1s ease, transform 1s ease;
        }
        
        .scroll-fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* 平滑滚动 */
        html {
            scroll-behavior: smooth;
        }

        /* 滚动进度指示器 */
        .scroll-progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 0%;
            height: 3px;
            background: linear-gradient(90deg, var(--c-red), var(--c-gold));
            z-index: 9999;
            transition: width 0.1s ease;
        }

        /* 返回顶部按钮 */
        .back-to-top {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 50px;
            height: 50px;
            background: var(--c-red);
            color: white;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 999;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .back-to-top.visible {
            opacity: 1;
            visibility: visible;
        }

        .back-to-top:hover {
            background: var(--c-gold);
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        /* 路线卡片增强效果 */
        .route-card {
            transition: all 0.3s ease;
        }
        
        .route-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        /* 添加分享和收藏按钮样式 */
        .route-actions {
            margin: 30px 0;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: var(--c-paper);
            border: 1px solid #e0ded6;
            border-radius: 4px;
            cursor: pointer;
            font-family: var(--f-body);
            font-size: 0.9rem;
            color: var(--c-ink);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s ease;
        }
        
        .action-btn:hover::before {
            left: 100%;
        }
        
        .action-btn:hover {
            background: var(--c-red);
            color: white;
            border-color: var(--c-red);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(142, 53, 74, 0.3);
        }
        
        /* 收藏按钮激活状态 */
        .action-btn.favorited {
            background: var(--c-red);
            color: white;
            border-color: var(--c-red);
        }
        
        .action-btn.favorited .favorite-icon {
            animation: heartBeat 0.6s ease;
        }
        
        @keyframes heartBeat {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.3);
            }
        }
        
        /* 分享按钮特殊样式 */
        .share-btn {
            background: var(--c-gold) !important;
            color: white !important;
            border-color: var(--c-gold) !important;
        }
        
        .share-btn:hover {
            background: #A68B5E !important;
            border-color: #A68B5E !important;
        }
        
        /* 路线收藏功能 */
        .favorite-btn {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* 路线评分系统增强 */
        .route-rating {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
        }
        
        .stars {
            display: flex;
            gap: 5px;
        }
        
        .star {
            font-size: 1.2rem;
            color: var(--c-gold);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .star:hover {
            transform: scale(1.2);
        }
        
        .star.filled {
            color: #B59868;
            text-shadow: 0 0 10px rgba(181, 152, 104, 0.5);
        }
        
        /* 评分输入反馈 */
        .rating-feedback {
            font-size: 0.9rem;
            color: var(--c-gray);
            margin-left: 10px;
            transition: all 0.3s ease;
        }
        
        /* 路线评论功能 */
        .route-comments {
            margin: 40px 0;
            padding: 25px;
            background: var(--c-paper);
            border-radius: 8px;
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .comments-title {
            font-size: 1.2rem;
            color: var(--c-ink);
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .comment-form {
            display: flex;
            gap: 15px;
            flex-direction: column;
            margin-bottom: 30px;
        }
        
        .comment-input {
            padding: 12px;
            border: 1px solid #e0ded6;
            border-radius: 6px;
            background: white;
            font-family: var(--f-body);
            resize: vertical;
            min-height: 100px;
        }
        
        .comment-submit {
            align-self: flex-start;
            padding: 10px 25px;
            background: var(--c-red);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-family: var(--f-body);
            transition: all 0.3s ease;
        }
        
        .comment-submit:hover {
            background: var(--c-gold);
            transform: translateY(-2px);
        }
        
        /* 集章游戏增强 */
        .stamp-item {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stamp-item::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(181, 152, 104, 0.3), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        
        .stamp-item.collected::after {
            opacity: 1;
            animation: shine 1s ease-in-out;
        }
        
        @keyframes shine {
            0%, 100% {
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
        }
        
        /* 印章收集动画 */
        .stamp-item.collecting {
            animation: stampCollect 0.8s ease;
        }
        
        @keyframes stampCollect {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.15) rotate(10deg);
            }
        }
        
        /* 集章成就提示 */
        .achievement-notification {
            position: fixed;
            top: 100px;
            right: 30px;
            background: linear-gradient(135deg, var(--c-red), var(--c-gold));
            color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            animation: slideInRight 0.5s ease, fadeOut 0.5s ease 2.5s forwards;
            max-width: 300px;
        }
        
        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(50px);
            }
        }
        
        .achievement-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .achievement-content {
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        /* 添加路线推荐理由 */
        .route-reason {
            margin: 25px 0;
            padding: 20px;
            background: var(--c-paper);
            border-radius: 8px;
            border-left: 4px solid var(--c-red);
        }
        
        .reason-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--c-red);
        }
        
        /* 添加最佳游览时间 */
        .best-time {
            margin: 25px 0;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .time-label {
            font-weight: bold;
            color: var(--c-gray);
        }
        
        /* 添加交通指南 */
        .transport-guide {
            margin: 25px 0;
            padding: 20px;
            background: var(--c-paper);
            border-radius: 8px;
        }
        
        .transport-title {
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--c-red);
        }
        
        .transport-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .transport-icon {
            font-size: 1.2rem;
            color: var(--c-gold);
        }

        @media (max-width: 768px) {
            /* 基础样式调整 */
            .hero-title { font-size: 3rem; }
            .article-block, .article-block.reverse { grid-template-columns: 1fr; direction: ltr; }
            .project-img { height: 300px; }
            .menu { display: none; }
            
            /* 导航栏调整 */
            nav {
                padding: 0 20px;
            }
            
            .logo {
                font-size: 1.5rem;
            }
            
            /* 响应式布局调整 */
            .route-container {
                padding: 0 15px;
                margin: 80px auto;
            }
            
            .route-header h2 {
                font-size: 2.5rem;
            }
            
            /* 城市记忆卡片调整 */
            .city-memory {
                padding: 40px 0;
            }
            
            .memory-item {
                padding: 15px;
            }
            
            .memory-item img {
                height: 180px;
            }
            
            /* 集章游戏调整 */
            .stamps-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 20px;
            }
            
            .stamp-image {
                width: 80px;
                height: 80px;
                font-size: 2.5rem;
            }
            
            /* 路线详情调整 */
            .route-card {
                margin: 0 15px;
            }
            
            .route-content {
                padding: 20px;
            }
            
            .route-title {
                font-size: 1.5rem;
            }
            
            /* 语音导游调整 */
            .voice-controls {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .voice-slider {
                width: 100%;
                justify-content: space-between;
            }
            
            /* 虚拟漫游调整 */
            .panorama-container {
                height: 300px;
            }
            
            .panorama-controls {
                gap: 10px;
                padding: 8px 15px;
            }
            
            .panorama-btn {
                width: 35px;
                height: 35px;
            }
            
            /* AI聊天窗口调整 */
            #ai-chat {
                width: calc(100% - 40px);
                max-width: none;
                bottom: 80px;
                right: 20px;
            }
            
            /* 主题切换按钮调整 */
            .theme-toggle {
                font-size: 1.1rem;
                padding: 6px;
            }
            
            /* 响应式按钮调整 */
            .action-btn, .voice-btn {
                padding: 8px 16px;
                font-size: 0.85rem;
            }
        }
        
        /* 平板设备优化 */
        @media (min-width: 769px) and (max-width: 1024px) {
            .route-container {
                padding: 0 30px;
            }
            
            .article-block {
                gap: 40px;
            }
        }
        
        /* 高分辨率屏幕优化 */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            /* 优化图片显示 */
            .project-img {
                image-rendering: -webkit-optimize-contrast;
            }
        }
    </style>
</head>
<body>

    <div id="intro-overlay">
        <div class="intro-text">北平风物记</div>
        <p style="opacity: 0.7; letter-spacing: 2px; margin-top: 20px;">戴上耳机 · 聆听城市回响</p>
        <button class="btn-enter" onclick="enterSite()">开启漫游</button>
        <!-- 导入页音乐控制图标 -->
        <button id="intro-audio-btn" class="ambient-btn" style="display: flex; align-items: center; gap: 10px; padding: 10px 20px; background: rgba(255, 255, 255, 0.6); border: 1px solid rgba(255, 255, 255, 0.8); border-radius: 50px; cursor: pointer; font-family: var(--f-body); font-size: 0.9rem; color: var(--c-paper); transition: all 0.3s ease; backdrop-filter: blur(5px); margin-top: 30px; position: relative; z-index: 1;">
            <div class="sound-wave">
                <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
            </div>
            <span>背景音乐</span>
        </button>
    </div>

    <nav>
        <a href="index.html" class="logo">
            <img src="image/logo.png" alt="北平风物记" style="width: 40px; height: 40px; object-fit: contain;">
            <span style="margin-left: 10px; font-family: var(--f-title); font-size: 1.5rem; color: var(--c-red);">北平风物记</span>
        </a>
        <div class="menu">
            <a href="index.html" class="menu-item">首页</a>
            <a href="map.html" class="menu-item">漫游地图</a>
            <div class="menu-item">
                路线策展
                <div class="dropdown">
                    <a href="literature-route.html">文学与光阴</a>
                    <a href="jiangnan-route.html">北平江南</a>
                    <a href="ditan-route.html">与地坛同呼吸</a>
                </div>
            </div>
            <a href="about.html" class="menu-item">关于我们</a>
        </div>
        <!-- 夜间模式切换 -->
        <button id="theme-toggle" class="theme-toggle" style="background: none; border: none; cursor: pointer; font-size: 1.2rem; color: var(--c-ink); padding: 8px; transition: all 0.3s ease;">
            🌙
        </button>
    </nav>

    <header id="hero">
        <div class="hero-content">
            <h1 class="hero-title">触摸<br>城市的<br>掌纹</h1>
        </div>
    </header>



    <!-- 音频控制 -->
    <audio id="background-audio" loop>
        <source src="audio/beijingyinyue.mp3" type="audio/mpeg">
        您的浏览器不支持音频播放
    </audio>

    <!-- 滚动进度指示器 -->
    <div class="scroll-progress"></div>

    <div class="audio-control" style="position: fixed; bottom: 20px; right: 20px; z-index: 1000;">
        <button id="audio-btn" class="ambient-btn" style="display: flex; align-items: center; gap: 10px; padding: 10px 20px; background: rgba(255, 255, 255, 0.9); border: 1px solid var(--c-gray); border-radius: 50px; cursor: pointer; font-family: var(--f-body); font-size: 0.9rem; color: var(--c-ink); transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
            <div class="sound-wave">
                <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
            </div>
            <span>沉浸 · 城市声音</span>
        </button>
    </div>
    
    <!-- 返回顶部按钮 -->
    <button class="back-to-top" id="back-to-top" title="返回顶部">
        ↑
    </button>
    
    <div id="ai-assistant" style="position: fixed; bottom: 18px; right: 200px; z-index: 1000;">
        <button id="ai-btn" style="display: flex; align-items: center; gap: 10px; padding: 10px 20px; background: rgba(255, 255, 255, 0.9); border: 1px solid var(--c-gray); border-radius: 50px; cursor: pointer; font-family: var(--f-body); font-size: 0.9rem; color: var(--c-ink); transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
            <span style="font-size: 1.2rem;">🤖</span>
            <span>智能助手</span>
        </button>
        
        <div id="ai-chat" style="position: absolute; bottom: 60px; right: 0; width: 350px; max-height: 400px; background: white; border-radius: 12px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); display: none; flex-direction: column; overflow: hidden; z-index: 1001;">
            <div style="background: var(--c-red); color: white; padding: 15px; text-align: center; font-weight: bold;">
                北平文化智能助手
            </div>
            
            <div id="chat-messages" style="flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; height: 250px;">
                <div style="background: var(--c-paper); padding: 10px 15px; border-radius: 18px 18px 18px 5px; align-self: flex-start; max-width: 80%;">
                    <p style="margin: 0; color: var(--c-ink);">您好！我是北平风物君，有什么可以帮您了解的？</p>
                </div>
            </div>
            
            <div style="padding: 15px; border-top: 1px solid #eee; background: #fff;">
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="chat-input" placeholder="输入您的问题..." style="flex: 1; padding: 10px 15px; border: 1px solid #ddd; border-radius: 25px; font-family: var(--f-body); outline: none;">
                    <button id="send-btn" style="padding: 10px 15px; background: var(--c-red); color: white; border: none; border-radius: 50%; cursor: pointer; font-size: 1.2rem; transition: 0.2s;">
                        ➤
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 路线策展页面 -->
    <section class="routes-section">
        <div class="container">
            <h2 class="section-title">路线策展</h2>
            <p class="section-subtitle">探索北平的文化脉络，感受历史与现代的交融</p>
            
            <!-- 城市记忆板块 -->
            <section class="city-memory" style="padding: 60px 0; background: var(--c-paper); text-align: center;">
                <h2 style="font-family: var(--f-title); font-size: 3rem; color: var(--c-red); margin-bottom: 40px;">城市记忆</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin-bottom: 60px;">
                    <a href="literature-route.html" class="memory-item" style="text-decoration: none; cursor: pointer; transition: transform 0.3s ease; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); display: block;">
                        <img src="image/wansongta.png" alt="万松老人塔" style="width: 100%; height: 200px; object-fit: cover; border-radius: 4px; margin-bottom: 20px;">
                        <h3 style="font-size: 1.4rem; color: var(--c-ink); margin-bottom: 10px;">文学与光阴的交错</h3>
                        <p style="color: var(--c-gray); line-height: 1.6;">从古塔到藏书楼的北平三重时间，探索北京的文学与历史记忆，感受时间的流转与文明的传承。</p>
                    </a>
                    <a href="jiangnan-route.html" class="memory-item" style="text-decoration: none; cursor: pointer; transition: transform 0.3s ease; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); display: block;">
                        <img src="image/jiangnan-bamboo-01.jpg" alt="北平江南" style="width: 100%; height: 200px; object-fit: cover; border-radius: 4px; margin-bottom: 20px;">
                        <h3 style="font-size: 1.4rem; color: var(--c-ink); margin-bottom: 10px;">北京的江南烟雨</h3>
                        <p style="color: var(--c-gray); line-height: 1.6;">体验北方的江南水乡风情，在紫竹院中感受皇家园林的南渡梦影，探索友贤山馆、翠池等景点。</p>
                    </a>
                    <a href="ditan-route.html" class="memory-item" style="text-decoration: none; cursor: pointer; transition: transform 0.3s ease; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); display: block;">
                        <img src="image/ditan-courtyard-03.jpg" alt="与地坛同呼吸" style="width: 100%; height: 200px; object-fit: cover; border-radius: 4px; margin-bottom: 20px;">
                        <h3 style="font-size: 1.4rem; color: var(--c-ink); margin-bottom: 10px;">与地坛同呼吸</h3>
                        <p style="color: var(--c-gray); line-height: 1.6;">跟随史铁生的脚步探索地坛的文学与生命意义，在寂静中听见生命的回响，感受生命的沉思与力量。</p>
                    </a>
                </div>
            </section>
            
            <!-- 集章游戏板块 -->
            <section class="stamp-section">
                <div class="container">
                    <h2 class="stamp-title">城市记忆集章</h2>
                    <div class="stamp-progress">
                        <p>已收集 <span id="stamp-count">0</span>/5 个印章</p>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                    </div>
                    
                    <div class="stamps-grid">
                        <!-- 印章1：文学与光阴 -->
                        <div class="stamp-item" data-stamp="literature">
                            <div class="stamp-image">📜</div>
                            <h3 class="stamp-name">文学与光阴</h3>
                            <p class="stamp-status">未收集</p>
                        </div>
                        
                        <!-- 印章2：江南烟雨 -->
                        <div class="stamp-item" data-stamp="jiangnan">
                            <div class="stamp-image">🌧️</div>
                            <h3 class="stamp-name">江南烟雨</h3>
                            <p class="stamp-status">未收集</p>
                        </div>
                        
                        <!-- 印章3：与地坛同呼吸 -->
                        <div class="stamp-item" data-stamp="ditan">
                            <div class="stamp-image">🌳</div>
                            <h3 class="stamp-name">与地坛同呼吸</h3>
                            <p class="stamp-status">未收集</p>
                        </div>
                        
                        <!-- 印章4：城市探索者 -->
                        <div class="stamp-item" data-stamp="explorer">
                            <div class="stamp-image">🧭</div>
                            <h3 class="stamp-name">城市探索者</h3>
                            <p class="stamp-status">未收集</p>
                        </div>
                        
                        <!-- 印章5：文化传承者 -->
                        <div class="stamp-item" data-stamp="heritage">
                            <div class="stamp-image">🏛️</div>
                            <h3 class="stamp-name">文化传承者</h3>
                            <p class="stamp-status">未收集</p>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 40px;">
                        <button class="view-btn reset-btn" onclick="resetStamps()" style="background: var(--c-gray); margin-bottom: 10px;">重置集章状态</button>
                        <p style="margin-top: 20px; color: var(--c-gray); font-size: 0.9rem;">探索不同路线，收集更多印章吧！</p>
                    </div>
                </div>
            </section>

            <!-- 路线详情区域 -->
            <!-- 路线1：文学与光阴的交错详情 -->
            <section class="route-details-section" id="literature-details">
                <a href="#" class="back-btn" onclick="showCityMemory()">← 返回城市记忆</a>
                <div class="route-card" style="max-width: 800px; margin: 0 auto;">
                    <div class="route-image">
                        <div class="route-number">01</div>
                    </div>
                    <div class="route-content">
                        <h3 class="route-title">文学与光阴的交错</h3>
                        <p class="route-subtitle">从古塔到藏书楼的北平三重时间</p>
                        <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
                            <span class="route-duration">2-3小时</span>
                            <div style="flex: 1; height: 1px; background: var(--c-gray); opacity: 0.3;"></div>
                            <span style="color: var(--c-gold); font-weight: bold;">📚 文学之旅</span>
                        </div>
                        <p class="route-description">探索北京的文学与历史记忆，从万松老人塔到正阳书局，再到红楼藏书楼，感受时间的流转与文明的传承。</p>
                        <div class="route-highlights">
                            <span class="highlight-tag">万松老人塔</span>
                            <span class="highlight-tag">正阳书局</span>
                            <span class="highlight-tag">红楼藏书楼</span>
                        </div>
                        <!-- 添加路线特色标签 -->
                        <div style="margin: 25px 0; display: flex; flex-wrap: wrap; gap: 10px;">
                            <div style="display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: var(--c-paper); border-radius: 20px; font-size: 0.9rem;">
                                <span>🌟</span>
                                <span>文化深度</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: var(--c-paper); border-radius: 20px; font-size: 0.9rem;">
                                <span>📖</span>
                                <span>文学氛围</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: var(--c-paper); border-radius: 20px; font-size: 0.9rem;">
                                <span>🕰️</span>
                                <span>历史悠久</span>
                            </div>
                        </div>
                        
                        <!-- AI语音导游 -->
                        <div class="voice-guide">
                            <h4 class="voice-guide-title">🤖 AI语音导游</h4>
                            <div class="voice-controls">
                                <button class="voice-btn" id="play-btn-literature" onclick="toggleVoiceGuide('literature')">
                                    <span>▶️</span>
                                    <span>播放讲解</span>
                                    <div class="voice-wave">
                                        <div class="voice-bar"></div>
                                        <div class="voice-bar"></div>
                                        <div class="voice-bar"></div>
                                        <div class="voice-bar"></div>
                                    </div>
                                </button>
                                <button class="voice-btn" onclick="stopVoiceGuide()">
                                    <span>⏹️</span>
                                    <span>停止讲解</span>
                                </button>
                                <div class="voice-slider">
                                    <label for="rate-slider">语速:</label>
                                    <input type="range" id="rate-slider" min="0.5" max="2" step="0.1" value="1">
                                    <span id="rate-value">1.0</span>
                                </div>
                            </div>
                            <div class="voice-status" id="voice-status-literature">
                                点击播放按钮，聆听路线讲解
                            </div>
                        </div>
                        
                        <!-- 虚拟漫游 -->
                        <div class="virtual-tour">
                            <h4 class="virtual-tour-title">🗺️ 虚拟漫游</h4>
                            
                            <!-- 嵌入720云全景 -->
                            <div style="margin-bottom: 20px;">
                                <a href="https://www.720yun.com/t/4edjzgkytf1?scene_id=9377236" target="_blank" style="display: block; text-align: center; padding: 20px; background: var(--c-paper); border-radius: 12px; border: 2px dashed var(--c-red); text-decoration: none; transition: all 0.3s ease;">
                                    <div style="font-size: 2rem; margin-bottom: 10px;">🌐</div>
                                    <div style="font-size: 1.2rem; color: var(--c-red); margin-bottom: 8px;">📹 点击体验720°全景漫游</div>
                                    <div style="color: var(--c-gray); font-size: 0.9rem;">进入万松老人塔沉浸式全景体验</div>
                                </a>
                            </div>
                            
                            <div class="panorama-container" id="panorama-literature">
                                <div class="panorama-image" style="background-image: url('image/wansongta.png')"></div>
                                
                                <!-- 热点标记 -->
                                <div class="hotspot" data-label="万松老人塔" style="top: 40%; left: 30%;" data-info="万松老人塔是一座八角九级密檐塔，已经静立了八百多年，是金元之际禅宗巨匠万松行秀的纪念塔。"></div>
                                <div class="hotspot" data-label="正阳书局" style="top: 50%; left: 50%;" data-info="正阳书局是北京唯一一家专营北京地方文献的旧书店，在这里你可以找到大量关于北京历史、地理、民俗的书籍。"></div>
                                <div class="hotspot" data-label="红楼藏书楼" style="top: 60%; left: 70%;" data-info="红楼藏书楼的前身是红楼电影院，2018年转型为公共藏书楼，完美演绎了'旧瓶装新酒'的理念。"></div>
                                
                                <!-- 热点信息面板 -->
                                <div class="hotspot-info" id="hotspot-info">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                                        <h4 id="hotspot-title" style="margin: 0;color: var(--c-red);"></h4>
                                        <button class="close-hotspot-info" style="background: none; border: none; color: var(--c-gray); font-size: 1.5rem; cursor: pointer; padding: 0; line-height: 1;margin: 0;opacity: 0.7;transition: opacity 0.3s;">
                                            ×
                                        </button>
                                    </div>
                                    <p id="hotspot-content" style="margin: 0; color: var(--c-ink); line-height: 1.6;"></p>
                                </div>
                                
                                <!-- 全景控制按钮 -->
                                <div class="panorama-controls">
                                    <button class="panorama-btn" onclick="panoramaMove('literature', -10)" title="向左移动">
                                        ←
                                    </button>
                                    <button class="panorama-btn" onclick="panoramaMove('literature', 10)" title="向右移动">
                                        →
                                    </button>
                                    <button class="panorama-btn" onclick="panoramaZoom('literature', 1.1)" title="放大">
                                        🔍+
                                    </button>
                                    <button class="panorama-btn" onclick="panoramaZoom('literature', 0.9)" title="缩小">
                                        🔍-
                                    </button>
                                    <button class="panorama-btn" onclick="panoramaReset('literature')" title="重置">
                                        🔄
                                    </button>
                                </div>
                                
                                <!-- 提示信息 -->
                                <div style="position: absolute; top: 20px; left: 50%; transform: translateX(-50%); background: rgba(0, 0, 0, 0.7); color: white; padding: 8px 16px; border-radius: 20px; font-size: 0.8rem; opacity: 0.8; z-index: 10;">
                                    拖动鼠标或触摸滑动浏览全景
                                </div>
                            </div>
                        </div>
                        
                        <!-- 进入完整路线按钮 -->
                        <a href="literature-route.html" class="view-btn">进入完整路线</a>
                        
                        <!-- 路线亮点链接示例 -->
                        <div class="route-highlights-links" style="margin-top: 25px;">
                            <h4 style="color: var(--c-ink); margin-bottom: 15px;">📌 相关景点链接</h4>
                            <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                                <a href="https://baike.baidu.com/item/%E4%B8%87%E6%9D%BE%E8%80%81%E4%BA%BA%E5%A1%94/2486420" target="_blank" style="display: inline-block; padding: 8px 15px; background: var(--c-paper); border-radius: 20px; font-size: 0.9rem; color: var(--c-red); text-decoration: none; transition: all 0.3s ease; border: 1px solid var(--c-paper);">
                                    🔗 万松老人塔详情
                                </a>
                                <a href="https://www.beijing.gov.cn/renwen/rwzyd/qxdw/jxndqcqx/zhyshj/202309/t20230918_3261515.html" target="_blank" style="display: inline-block; padding: 8px 15px; background: var(--c-paper); border-radius: 20px; font-size: 0.9rem; color: var(--c-red); text-decoration: none; transition: all 0.3s ease; border: 1px solid var(--c-paper);">
                                    🔗 正阳书局详情
                                </a>
                                <a href="https://baike.baidu.com/item/%E5%8C%97%E4%BA%AC%E7%BA%A2%E6%A5%BC%E5%85%AC%E5%85%B1%E8%97%8F%E4%B9%A6%E9%A6%86/54715299" target="_blank" style="display: inline-block; padding: 8px 15px; background: var(--c-paper); border-radius: 20px; font-size: 0.9rem; color: var(--c-red); text-decoration: none; transition: all 0.3s ease; border: 1px solid var(--c-paper);">
                                    🔗 红楼藏书楼详情
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- 路线2：北京的江南烟雨详情 -->
            <section class="route-details-section" id="jiangnan-details">
                <a href="#" class="back-btn" onclick="showCityMemory()">← 返回城市记忆</a>
                <div class="route-card" style="max-width: 800px; margin: 0 auto;">
                    <div class="route-image">
                        <div class="route-number">02</div>
                    </div>
                    <div class="route-content">
                        <h3 class="route-title">北京的江南烟雨</h3>
                        <p class="route-subtitle">一座皇家园林的南渡梦影</p>
                        <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
                            <span class="route-duration">3-4小时</span>
                            <div style="flex: 1; height: 1px; background: var(--c-gray); opacity: 0.3;"></div>
                            <span style="color: var(--c-gold); font-weight: bold;">🌧️ 江南风情</span>
                        </div>
                        <p class="route-description">体验北方的江南水乡风情，在紫竹院中感受皇家园林的南渡梦影，探索友贤山馆、翠池、问月楼等景点。</p>
                        <div class="route-highlights">
                            <span class="highlight-tag">友贤山馆</span>
                            <span class="highlight-tag">翠池</span>
                            <span class="highlight-tag">问月楼</span>
                            <span class="highlight-tag">紫御湾码头</span>
                        </div>
                        <!-- 添加路线特色标签 -->
                        <div style="margin: 25px 0; display: flex; flex-wrap: wrap; gap: 10px;">
                            <div style="display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: var(--c-paper); border-radius: 20px; font-size: 0.9rem;">
                                <span>🌟</span>
                                <span>江南韵味</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: var(--c-paper); border-radius: 20px; font-size: 0.9rem;">
                                <span>🎋</span>
                                <span>竹林景观</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: var(--c-paper); border-radius: 20px; font-size: 0.9rem;">
                                <span>🏞️</span>
                                <span>山水园林</span>
                            </div>
                        </div>
                        
                        <!-- AI语音导游 -->
                        <div class="voice-guide">
                            <h4 class="voice-guide-title">🤖 AI语音导游</h4>
                            <div class="voice-controls">
                                <button class="voice-btn" id="play-btn-jiangnan" onclick="toggleVoiceGuide('jiangnan')">
                                    <span>▶️</span>
                                    <span>播放讲解</span>
                                    <div class="voice-wave">
                                        <div class="voice-bar"></div>
                                        <div class="voice-bar"></div>
                                        <div class="voice-bar"></div>
                                        <div class="voice-bar"></div>
                                    </div>
                                </button>
                                <button class="voice-btn" onclick="stopVoiceGuide()">
                                    <span>⏹️</span>
                                    <span>停止讲解</span>
                                </button>
                                <div class="voice-slider">
                                    <label for="rate-slider">语速:</label>
                                    <input type="range" id="rate-slider" min="0.5" max="2" step="0.1" value="1">
                                    <span id="rate-value">1.0</span>
                                </div>
                            </div>
                            <div class="voice-status" id="voice-status-jiangnan">
                                点击播放按钮，聆听路线讲解
                            </div>
                        </div>
                        
                        <!-- 虚拟漫游 -->
                        <div class="virtual-tour">
                            <h4 class="virtual-tour-title">🗺️ 虚拟漫游</h4>
                            
                            <!-- 嵌入720云全景 -->
                            <div style="margin-bottom: 20px;">
                                <a href="https://www.720yun.com/t/5c6259rdmtn?scene_id=1582794" target="_blank" style="display: block; text-align: center; padding: 20px; background: var(--c-paper); border-radius: 12px; border: 2px dashed var(--c-red); text-decoration: none; transition: all 0.3s ease;">
                                    <div style="font-size: 2rem; margin-bottom: 10px;">🌐</div>
                                    <div style="font-size: 1.2rem; color: var(--c-red); margin-bottom: 8px;">📹 点击体验720°全景漫游</div>
                                    <div style="color: var(--c-gray); font-size: 0.9rem;">进入紫竹院公园沉浸式全景体验</div>
                                </a>
                            </div>
                            
                            <div class="panorama-container" id="panorama-jiangnan">
                                <div class="panorama-image" style="background-image: url('image/jiangnan-bamboo-01.jpg')"></div>
                                
                                <!-- 热点标记 -->
                                <div class="hotspot" data-label="友贤山馆" style="top: 40%; left: 30%;" data-info="友贤山馆是一座仿江南民居的院落，常设江南书画展。"></div>
                                <div class="hotspot" data-label="翠池" style="top: 50%; left: 50%;" data-info="翠池是全园竹景的精华，也是'烟雨'气质的源泉。"></div>
                                <div class="hotspot" data-label="问月楼" style="top: 60%; left: 70%;" data-info="从问月楼可以俯瞰全园景色，是观景的绝佳位置。"></div>
                                
                                <!-- 热点信息面板 -->
                                <div class="hotspot-info" id="hotspot-info-jiangnan">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                                        <h4 id="hotspot-title-jiangnan" style="margin: 0; color: var(--c-red);"></h4>
                                        <button class="close-hotspot-info" style="background: none; border: none; color: var(--c-gray); font-size: 1.5rem; cursor: pointer; padding: 0; line-height: 1; margin: 0; opacity: 0.7; transition: opacity 0.3s;">
                                            ×
                                        </button>
                                    </div>
                                    <p id="hotspot-content-jiangnan" style="margin: 0; color: var(--c-ink); line-height: 1.6;"></p>
                                </div>
                                
                                <!-- 全景控制按钮 -->
                                <div class="panorama-controls">
                                    <button class="panorama-btn" onclick="panoramaMove('jiangnan', -10)" title="向左移动">
                                        ←
                                    </button>
                                    <button class="panorama-btn" onclick="panoramaMove('jiangnan', 10)" title="向右移动">
                                        →
                                    </button>
                                    <button class="panorama-btn" onclick="panoramaZoom('jiangnan', 1.1)" title="放大">
                                        🔍+
                                    </button>
                                    <button class="panorama-btn" onclick="panoramaZoom('jiangnan', 0.9)" title="缩小">
                                        🔍-
                                    </button>
                                    <button class="panorama-btn" onclick="panoramaReset('jiangnan')" title="重置">
                                        🔄
                                    </button>
                                </div>
                                
                                <!-- 提示信息 -->
                                <div style="position: absolute; top: 20px; left: 50%; transform: translateX(-50%); background: rgba(0, 0, 0, 0.7); color: white; padding: 8px 16px; border-radius: 20px; font-size: 0.8rem; opacity: 0.8; z-index: 10;">
                                    拖动鼠标或触摸滑动浏览全景
                                </div>
                            </div>
                        </div>
                        
                        <!-- 进入完整路线按钮 -->
                        <a href="jiangnan-route.html" class="view-btn">进入完整路线</a>
                        
                        <!-- 路线亮点链接示例 -->
                        <div class="route-highlights-links" style="margin-top: 25px;">
                            <h4 style="color: var(--c-ink); margin-bottom: 15px;">📌 相关景点链接</h4>
                            <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                                <a href="https://baike.baidu.com/item/%E7%B4%AB%E7%AB%B9%E9%99%A2/1250423?fromModule=lemma_search-box" target="_blank" style="display: inline-block; padding: 8px 15px; background: var(--c-paper); border-radius: 20px; font-size: 0.9rem; color: var(--c-red); text-decoration: none; transition: all 0.3s ease; border: 1px solid var(--c-paper);">
                                    🔗 紫竹院详情
                                </a>
                                <a href="https://baike.baidu.com/item/%E5%8F%8B%E8%B4%A4%E5%B1%B1%E9%A6%86" target="_blank" style="display: inline-block; padding: 8px 15px; background: var(--c-paper); border-radius: 20px; font-size: 0.9rem; color: var(--c-red); text-decoration: none; transition: all 0.3s ease; border: 1px solid var(--c-paper);">
                                    🔗 友贤山馆详情
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- 路线3：与地坛同呼吸详情 -->
            <section class="route-details-section" id="ditan-details">
                <a href="#" class="back-btn" onclick="showCityMemory()">← 返回城市记忆</a>
                <div class="route-card" style="max-width: 800px; margin: 0 auto;">
                    <div class="route-image">
                        <div class="route-number">03</div>
                    </div>
                    <div class="route-content">
                        <h3 class="route-title">与地坛同呼吸</h3>
                        <p class="route-subtitle">在寂静中，听见生命的回响</p>
                        <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
                            <span class="route-duration">2-3小时</span>
                            <div style="flex: 1; height: 1px; background: var(--c-gray); opacity: 0.3;"></div>
                            <span style="color: var(--c-gold); font-weight: bold;">🌳 生命沉思</span>
                        </div>
                        <p class="route-description">跟随史铁生的脚步探索地坛的文学与生命意义，在方泽坛、古柏区、神库等地感受生命的沉思与力量。</p>
                        <div class="route-highlights">
                            <span class="highlight-tag">方泽坛</span>
                            <span class="highlight-tag">古柏区</span>
                            <span class="highlight-tag">神库</span>
                            <span class="highlight-tag">我与地坛书店</span>
                        </div>
                        <!-- 添加路线特色标签 -->
                        <div style="margin: 25px 0; display: flex; flex-wrap: wrap; gap: 10px;">
                            <div style="display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: var(--c-paper); border-radius: 20px; font-size: 0.9rem;">
                                <span>🌟</span>
                                <span>哲学思考</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: var(--c-paper); border-radius: 20px; font-size: 0.9rem;">
                                <span>🍂</span>
                                <span>自然静谧</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: var(--c-paper); border-radius: 20px; font-size: 0.9rem;">
                                <span>📚</span>
                                <span>文学圣地</span>
                            </div>
                        </div>
                        
                        <!-- AI语音导游 -->
                        <div class="voice-guide">
                            <h4 class="voice-guide-title">🤖 AI语音导游</h4>
                            <div class="voice-controls">
                                <button class="voice-btn" id="play-btn-ditan" onclick="toggleVoiceGuide('ditan')">
                                    <span>▶️</span>
                                    <span>播放讲解</span>
                                    <div class="voice-wave">
                                        <div class="voice-bar"></div>
                                        <div class="voice-bar"></div>
                                        <div class="voice-bar"></div>
                                        <div class="voice-bar"></div>
                                    </div>
                                </button>
                                <button class="voice-btn" onclick="stopVoiceGuide()">
                                    <span>⏹️</span>
                                    <span>停止讲解</span>
                                </button>
                                <div class="voice-slider">
                                    <label for="rate-slider">语速:</label>
                                    <input type="range" id="rate-slider" min="0.5" max="2" step="0.1" value="1">
                                    <span id="rate-value">1.0</span>
                                </div>
                            </div>
                            <div class="voice-status" id="voice-status-ditan">
                                点击播放按钮，聆听路线讲解
                            </div>
                        </div>
                        
                        <!-- 虚拟漫游 -->
                        <div class="virtual-tour">
                            <h4 class="virtual-tour-title">🗺️ 虚拟漫游</h4>
                            
                            <!-- 嵌入720云全景 -->
                            <div style="margin-bottom: 20px;">
                                <a href="https://www.720yun.com/t/8dvkswpm7p7?scene_id=46591123" target="_blank" style="display: block; text-align: center; padding: 20px; background: var(--c-paper); border-radius: 12px; border: 2px dashed var(--c-red); text-decoration: none; transition: all 0.3s ease;">
                                    <div style="font-size: 2rem; margin-bottom: 10px;">🌐</div>
                                    <div style="font-size: 1.2rem; color: var(--c-red); margin-bottom: 8px;">📹 点击体验720°全景漫游</div>
                                    <div style="color: var(--c-gray); font-size: 0.9rem;">进入地坛公园沉浸式全景体验</div>
                                </a>
                            </div>
                            
                            <div class="panorama-container" id="panorama-ditan">
                                <div class="panorama-image" style="background-image: url('image/ditan-courtyard-03.jpg')"></div>
                                
                                <!-- 热点标记 -->
                                <div class="hotspot" data-label="方泽坛" style="top: 40%; left: 30%;" data-info="方泽坛是皇帝祭祀'皇地祇'的神圣坛城。"></div>
                                <div class="hotspot" data-label="古柏区" style="top: 50%; left: 50%;" data-info="这里的古柏已有三四百年历史，见证了地坛的沧桑变迁。"></div>
                                <div class="hotspot" data-label="神库" style="top: 60%; left: 70%;" data-info="神库曾存放神牌与礼器，是地坛的重要组成部分。"></div>
                                
                                <!-- 热点信息面板 -->
                                <div class="hotspot-info" id="hotspot-info-ditan">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                                        <h4 id="hotspot-title-ditan" style="margin: 0; color: var(--c-red);"></h4>
                                        <button class="close-hotspot-info" style="background: none; border: none; color: var(--c-gray); font-size: 1.5rem; cursor: pointer; padding: 0; line-height: 1; margin: 0; opacity: 0.7; transition: opacity 0.3s;">
                                            ×
                                        </button>
                                    </div>
                                    <p id="hotspot-content-ditan" style="margin: 0; color: var(--c-ink); line-height: 1.6;"></p>
                                </div>
                                
                                <!-- 全景控制按钮 -->
                                <div class="panorama-controls">
                                    <button class="panorama-btn" onclick="panoramaMove('ditan', -10)" title="向左移动">
                                        ←
                                    </button>
                                    <button class="panorama-btn" onclick="panoramaMove('ditan', 10)" title="向右移动">
                                        →
                                    </button>
                                    <button class="panorama-btn" onclick="panoramaZoom('ditan', 1.1)" title="放大">
                                        🔍+
                                    </button>
                                    <button class="panorama-btn" onclick="panoramaZoom('ditan', 0.9)" title="缩小">
                                        🔍-
                                    </button>
                                    <button class="panorama-btn" onclick="panoramaReset('ditan')" title="重置">
                                        🔄
                                    </button>
                                </div>
                                
                                <!-- 提示信息 -->
                                <div style="position: absolute; top: 20px; left: 50%; transform: translateX(-50%); background: rgba(0, 0, 0, 0.7); color: white; padding: 8px 16px; border-radius: 20px; font-size: 0.8rem; opacity: 0.8; z-index: 10;">
                                    拖动鼠标或触摸滑动浏览全景
                                </div>
                            </div>
                        </div>
                        
                        <!-- 进入完整路线按钮 -->
                        <a href="ditan-route.html" class="view-btn">进入完整路线</a>
                        
                        <!-- 路线亮点链接示例 -->
                        <div class="route-highlights-links" style="margin-top: 25px;">
                            <h4 style="color: var(--c-ink); margin-bottom: 15px;">📌 相关景点链接</h4>
                            <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                                <a href="https://baike.baidu.com/item/%E5%9C%B0%E5%9D%9B/428250" target="_blank" style="display: inline-block; padding: 8px 15px; background: var(--c-paper); border-radius: 20px; font-size: 0.9rem; color: var(--c-red); text-decoration: none; transition: all 0.3s ease; border: 1px solid var(--c-paper);">
                                    🔗 地坛详情
                                </a>
                                <a href="https://baike.baidu.com/item/%E6%96%B9%E6%B3%BD%E5%9D%80" target="_blank" style="display: inline-block; padding: 8px 15px; background: var(--c-paper); border-radius: 20px; font-size: 0.9rem; color: var(--c-red); text-decoration: none; transition: all 0.3s ease; border: 1px solid var(--c-paper);">
                                    🔗 方泽坛详情
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </section>

    <script>
        // 开场逻辑 - 确保在全局作用域中定义，以便按钮的onclick事件能够调用它
function enterSite() {
    const overlay = document.getElementById('intro-overlay');
    if(overlay) {
        overlay.style.opacity = '0';
        setTimeout(() => overlay.style.visibility = 'hidden', 1000);
    }
    
    // 强制播放音频
    const audio = document.getElementById('background-audio');
    const audioBtn = document.getElementById('audio-btn');
    if (audio) {
        audio.play().then(() => {
            if (audioBtn) audioBtn.classList.add('playing');
        }).catch(e => console.log("请点击右下角按钮播放音乐", e));
    }
}

        // 页面加载后初始化
        document.addEventListener('DOMContentLoaded', () => {
            console.log('音频已准备就绪，等待用户交互');
            
            // 音频控制逻辑 - 在DOM加载完成后初始化
            const audio = document.getElementById('background-audio');
            const audioBtn = document.getElementById('audio-btn');
            const introAudioBtn = document.getElementById('intro-audio-btn');
            let isPlaying = false;

            // 音频控制按钮功能
            function toggleAudio() {
                if (isPlaying) {
                    audio.pause();
                    if (audioBtn) audioBtn.classList.remove('playing');
                    if (introAudioBtn) introAudioBtn.classList.remove('playing');
                } else {
                    audio.play().then(() => {
                        if (audioBtn) audioBtn.classList.add('playing');
                        if (introAudioBtn) introAudioBtn.classList.add('playing');
                        isPlaying = true;
                    }).catch(error => {
                        console.log('音频播放失败:', error);
                    });
                }
                isPlaying = !isPlaying;
            }

            // 为音频控制按钮添加事件监听
            if (audioBtn) {
                audioBtn.addEventListener('click', toggleAudio);
            }
            
            // 为导入页音频控制按钮添加事件监听
            if (introAudioBtn) {
                introAudioBtn.addEventListener('click', toggleAudio);
            }
        });

     
        // 路线策展功能
        
        // 显示路线详情
        function showRouteDetails(routeId) {
            // 隐藏城市记忆
            document.querySelector('.city-memory').style.display = 'none';
            
            // 隐藏集章游戏
            document.querySelector('.stamp-section').style.display = 'none';
            
            // 隐藏所有路线详情
            const allDetails = document.querySelectorAll('.route-details-section');
            allDetails.forEach(section => {
                section.classList.remove('active');
            });
            
            // 显示对应路线详情
            const targetDetails = document.getElementById(routeId);
            if (targetDetails) {
                targetDetails.classList.add('active');
            }
            
            // 根据路线自动收集对应印章
            if (routeId === 'literature-details') {
                collectStamp('literature');
            } else if (routeId === 'jiangnan-details') {
                collectStamp('jiangnan');
            } else if (routeId === 'ditan-details') {
                collectStamp('ditan');
            }
        }
        
        // 显示城市记忆
        function showCityMemory() {
            // 显示城市记忆
            document.querySelector('.city-memory').style.display = 'block';
            
            // 显示集章游戏
            document.querySelector('.stamp-section').style.display = 'block';
            
            // 隐藏所有路线详情
            const allDetails = document.querySelectorAll('.route-details-section');
            allDetails.forEach(section => {
                section.classList.remove('active');
            });
            
            // 更新集章进度
            updateStampProgress();
        }
        
        // 为城市记忆卡片添加点击事件
        document.addEventListener('DOMContentLoaded', function() {
            // 获取所有城市记忆卡片
            const memoryItems = document.querySelectorAll('.memory-item');
            
            // 为每个卡片添加点击事件
            memoryItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    // 根据卡片内容确定要显示的路线详情
                    if (this.querySelector('h3').textContent.includes('文学与光阴')) {
                        showRouteDetails('literature-details');
                    } else if (this.querySelector('h3').textContent.includes('江南烟雨')) {
                        showRouteDetails('jiangnan-details');
                    } else if (this.querySelector('h3').textContent.includes('与地坛同呼吸')) {
                        showRouteDetails('ditan-details');
                    }
                });
            });
            
            // 初始化集章游戏
            initStampGame();
        });
        
        // 集章游戏相关函数
        
        // 初始化集章游戏
        function initStampGame() {
            // 从localStorage加载集章状态
            const stamps = JSON.parse(localStorage.getItem('beipingStamps')) || {};
            
            // 更新所有印章的显示状态
            const stampItems = document.querySelectorAll('.stamp-item');
            stampItems.forEach(item => {
                const stampId = item.dataset.stamp;
                if (stamps[stampId]) {
                    item.classList.add('collected');
                    item.querySelector('.stamp-status').textContent = '已收集';
                } else {
                    // 确保未收集的印章显示为未收集状态
                    item.classList.remove('collected');
                    item.querySelector('.stamp-status').textContent = '未收集';
                }
            });
            
            // 更新集章进度
            updateStampProgress();
            
            // 如果所有路线都探索过，收集特殊印章
            if (stamps.literature && stamps.jiangnan && stamps.ditan) {
                collectStamp('explorer');
                // 如果收集了所有路线印章，收集文化传承者印章
                if (stamps.explorer) {
                    collectStamp('heritage');
                }
            }
        }
        
        // 收集单个印章
        function collectStamp(stampId) {
            // 从localStorage加载集章状态
            const stamps = JSON.parse(localStorage.getItem('beipingStamps')) || {};
            
            // 标记印章为已收集
            stamps[stampId] = true;
            
            // 保存到localStorage
            localStorage.setItem('beipingStamps', JSON.stringify(stamps));
            
            // 更新对应印章的显示
            const stampItem = document.querySelector(`[data-stamp="${stampId}"]`);
            if (stampItem) {
                stampItem.classList.add('collected');
                stampItem.querySelector('.stamp-status').textContent = '已收集';
                
                // 添加收集动画效果
                stampItem.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    stampItem.style.transform = '';
                }, 300);
            }
            
            // 更新集章进度
            updateStampProgress();
        }
        

        
        // 更新集章进度
        function updateStampProgress() {
            // 从localStorage加载集章状态
            const stamps = JSON.parse(localStorage.getItem('beipingStamps')) || {};
            
            // 计算已收集印章数量
            const collectedCount = Object.values(stamps).filter(Boolean).length;
            const totalCount = 5;
            
            // 更新进度显示
            document.getElementById('stamp-count').textContent = collectedCount;
            
            // 更新进度条
            const progressFill = document.getElementById('progress-fill');
            const progressPercentage = (collectedCount / totalCount) * 100;
            progressFill.style.width = `${progressPercentage}%`;
        }

        // 重置集章状态
        function resetStamps() {
            // 清除localStorage中的集章数据
            localStorage.removeItem('beipingStamps');
            
            // 重新初始化集章游戏
            initStampGame();
            
            // 显示成功提示
            alert('集章状态已重置，现在可以重新开始收集印章了！');
        }
        
        // AI语音导游相关函数
        
        // 路线讲解文本
        const routeExplanations = {
            literature: {
                title: "文学与光阴的交错",
                content: "欢迎来到文学与光阴的交错路线。这条路线从古塔到藏书楼，展现了北平的三重时间。首先，我们将参观万松老人塔，这座八角九级密檐塔已经静立了八百多年，是金元之际禅宗巨匠万松行秀的纪念塔。接着，我们将前往正阳书局，这是北京唯一一家专营北京地方文献的旧书店，在这里你可以找到大量关于北京历史、地理、民俗的书籍。最后，我们将参观红楼藏书楼，它的前身是红楼电影院，2018年转型为公共藏书楼，完美演绎了'旧瓶装新酒'的理念。"
            },
            jiangnan: {
                title: "北京的江南烟雨",
                content: "欢迎来到北京的江南烟雨路线。这条路线位于紫竹院公园，这里仿江南意趣营建，展现了北方的江南水乡风情。首先，我们将参观友贤山馆，这是一座仿江南民居的院落，常设江南书画展。接着，我们将前往翠池，这是全园竹景的精华，也是'烟雨'气质的源泉。然后，我们将登临问月楼，从这里可以俯瞰全园景色。最后，我们将到达紫御湾码头，这里曾是帝后登船的地方，现在是游览长河的起点。"
            },
            ditan: {
                title: "与地坛同呼吸",
                content: "欢迎来到与地坛同呼吸路线。这条路线跟随史铁生的脚步，探索地坛的文学与生命意义。首先，我们将参观方泽坛，这是皇帝祭祀'皇地祇'的神圣坛城。接着，我们将前往古柏区，这里的古柏已有三四百年历史，见证了地坛的沧桑变迁。然后，我们将参观神库与祭器库，这里曾存放神牌与礼器。最后，我们将到达钟楼，历史上祭祀前会在此鸣钟。地坛因为史铁生的散文《我与地坛》而成为了一个充满文学气息和生命力量的地方。"
            }
        };
        
        // 语音播放相关变量
        let currentUtterance = null;
        let isPlaying = false;
        let currentRoute = null;
        
        // 初始化语音合成
        function initSpeechSynthesis() {
            if ('speechSynthesis' in window) {
                // 设置默认语音为中文
                const voices = window.speechSynthesis.getVoices();
                const chineseVoice = voices.find(voice => 
                    voice.lang.includes('zh') || voice.name.includes('Chinese')
                );
                if (chineseVoice) {
                    // 存储默认语音
                    localStorage.setItem('defaultVoice', chineseVoice.name);
                }
            }
        }
        
        // 播放语音讲解
        function toggleVoiceGuide(routeId) {
            if (!('speechSynthesis' in window)) {
                alert('您的浏览器不支持语音合成功能');
                return;
            }
            
            // 如果当前正在播放，停止播放
            if (isPlaying) {
                stopVoiceGuide();
                return;
            }
            
            // 获取路线讲解内容
            const explanation = routeExplanations[routeId];
            if (!explanation) {
                return;
            }
            
            // 保存当前路线
            currentRoute = routeId;
            
            // 创建语音合成对象
            const utterance = new SpeechSynthesisUtterance();
            utterance.text = explanation.content;
            utterance.lang = 'zh-CN';
            
            // 设置语速
            const rate = parseFloat(document.getElementById('rate-slider').value);
            utterance.rate = rate;
            
            // 设置语音
            const voices = window.speechSynthesis.getVoices();
            const defaultVoiceName = localStorage.getItem('defaultVoice');
            const voice = voices.find(v => v.name === defaultVoiceName || v.lang.includes('zh'));
            if (voice) {
                utterance.voice = voice;
            }
            
            // 语音播放开始事件
            utterance.onstart = function() {
                isPlaying = true;
                // 更新按钮状态
                const playBtn = document.getElementById(`play-btn-${routeId}`);
                if (playBtn) {
                    playBtn.classList.add('playing');
                    playBtn.innerHTML = `
                        <span>⏸️</span>
                        <span>暂停讲解</span>
                        <div class="voice-wave">
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                        </div>
                    `;
                }
                // 更新状态信息
                const statusElement = document.getElementById(`voice-status-${routeId}`);
                if (statusElement) {
                    statusElement.innerHTML = `<span style="color: var(--c-red);">正在播放讲解...</span>`;
                }
            };
            
            // 语音播放结束事件
            utterance.onend = function() {
                isPlaying = false;
                currentUtterance = null;
                // 更新按钮状态
                const playBtn = document.getElementById(`play-btn-${routeId}`);
                if (playBtn) {
                    playBtn.classList.remove('playing');
                    playBtn.innerHTML = `
                        <span>▶️</span>
                        <span>播放讲解</span>
                        <div class="voice-wave">
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                        </div>
                    `;
                }
                // 更新状态信息
                const statusElement = document.getElementById(`voice-status-${routeId}`);
                if (statusElement) {
                    statusElement.innerHTML = '<span style="color: var(--c-gold);">讲解播放结束</span>';
                }
            };
            
            // 语音播放错误事件
            utterance.onerror = function() {
                isPlaying = false;
                currentUtterance = null;
                // 更新按钮状态
                const playBtn = document.getElementById(`play-btn-${routeId}`);
                if (playBtn) {
                    playBtn.classList.remove('playing');
                    playBtn.innerHTML = `
                        <span>▶️</span>
                        <span>播放讲解</span>
                        <div class="voice-wave">
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                        </div>
                    `;
                }
                // 更新状态信息
                const statusElement = document.getElementById(`voice-status-${routeId}`);
                if (statusElement) {
                    statusElement.innerHTML = '<span style="color: var(--c-red);">讲解播放失败</span>';
                }
            };
            
            // 保存当前语音对象
            currentUtterance = utterance;
            
            // 播放语音
            window.speechSynthesis.speak(utterance);
        }
        
        // 停止语音讲解
        function stopVoiceGuide() {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                isPlaying = false;
                currentUtterance = null;
                
                // 重置所有播放按钮
                const playBtns = document.querySelectorAll('[id^="play-btn-"]');
                playBtns.forEach(btn => {
                    btn.classList.remove('playing');
                    btn.innerHTML = `
                        <span>▶️</span>
                        <span>播放讲解</span>
                        <div class="voice-wave">
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                            <div class="voice-bar"></div>
                        </div>
                    `;
                });
                
                // 重置所有状态信息
                const statusElements = document.querySelectorAll('[id^="voice-status-"]');
                statusElements.forEach(el => {
                    el.textContent = '点击播放按钮，聆听路线讲解';
                });
            }
        }
        
        // 初始化语音合成和事件监听
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化语音合成
            initSpeechSynthesis();
            
            // 监听语音列表加载完成事件
            window.speechSynthesis.onvoiceschanged = initSpeechSynthesis;
            
            // 语速滑块事件监听
            const rateSlider = document.getElementById('rate-slider');
            if (rateSlider) {
                rateSlider.addEventListener('input', function() {
                    const rate = this.value;
                    document.getElementById('rate-value').textContent = rate;
                    // 如果当前正在播放，更新语速
                    if (currentUtterance && isPlaying) {
                        // 停止当前播放
                        stopVoiceGuide();
                        // 重新播放
                        toggleVoiceGuide(currentRoute);
                    }
                });
            }
            
            // 初始化虚拟漫游
            initPanorama();
            
            // 初始化文化知识答题
            initQuiz();
            
            // 初始化社交分享
            initSocialSharing();
        });
        
        // 虚拟漫游相关函数
        
        // 全景移动函数
        function panoramaMove(routeId, distance) {
            const panoramaContainer = document.getElementById(`panorama-${routeId}`);
            if (!panoramaContainer) return;
            
            const panoramaImage = panoramaContainer.querySelector('.panorama-image');
            if (!panoramaImage) return;
            
            // 获取当前的transform值
            const currentTransform = getComputedStyle(panoramaImage).transform;
            let translateX = 0;
            
            // 解析当前的translateX值
            if (currentTransform !== 'none') {
                const matrix = new DOMMatrix(currentTransform);
                translateX = matrix.m41;
            }
            
            // 计算新的translateX值，限制在-50%到0之间
            const newTranslateX = Math.max(-500, Math.min(0, translateX + distance));
            
            // 更新全景图位置
            panoramaImage.style.transform = `translateX(${newTranslateX}px)`;
        }
        
        // 全景缩放函数
        function panoramaZoom(routeId, scaleFactor) {
            const panoramaContainer = document.getElementById(`panorama-${routeId}`);
            if (!panoramaContainer) return;
            
            const panoramaImage = panoramaContainer.querySelector('.panorama-image');
            if (!panoramaImage) return;
            
            // 获取当前的transform值
            const currentTransform = getComputedStyle(panoramaImage).transform;
            let scale = 1;
            let translateX = 0;
            
            // 解析当前的scale值和translateX值
            if (currentTransform !== 'none') {
                const matrix = new DOMMatrix(currentTransform);
                scale = Math.sqrt(matrix.m11 * matrix.m11 + matrix.m12 * matrix.m12);
                translateX = matrix.m41;
            }
            
            // 计算新的scale值，限制在1到2之间
            const newScale = Math.max(1, Math.min(2, scale * scaleFactor));
            
            // 更新全景图缩放
            panoramaImage.style.transform = `translateX(${translateX}px) scale(${newScale})`;
        }
        
        // 全景重置函数
        function panoramaReset(routeId) {
            const panoramaContainer = document.getElementById(`panorama-${routeId}`);
            if (!panoramaContainer) return;
            
            const panoramaImage = panoramaContainer.querySelector('.panorama-image');
            if (!panoramaImage) return;
            
            // 重置transform
            panoramaImage.style.transform = '';
        }
        
        // 初始化虚拟漫游
        function initPanorama() {
            // 为所有热点添加点击事件
            const hotspots = document.querySelectorAll('.hotspot');
            
            hotspots.forEach(hotspot => {
                hotspot.addEventListener('click', function() {
                    const label = this.dataset.label;
                    const info = this.dataset.info;
                    const container = this.closest('.panorama-container');
                    const routeId = container.id.replace('panorama-', '');
                    
                    // 更新对应路线的热点信息面板
                    const hotspotInfo = container.querySelector('.hotspot-info');
                    const hotspotTitle = container.querySelector('#hotspot-title-' + routeId) || container.querySelector('.hotspot-title');
                    const hotspotContent = container.querySelector('#hotspot-content-' + routeId) || container.querySelector('.hotspot-content');
                    
                    // 修复热点信息面板选择器
                    if (hotspotInfo && !hotspotTitle && !hotspotContent) {
                        // 如果没有找到具体的title和content元素，使用hotspot-info内的通用元素
                        const infoTitle = hotspotInfo.querySelector('h4');
                        const infoContent = hotspotInfo.querySelector('p');
                        
                        if (infoTitle && infoContent) {
                            infoTitle.textContent = label;
                            infoContent.textContent = info;
                            hotspotInfo.classList.add('active');
                        }
                    } else if (hotspotInfo && hotspotTitle && hotspotContent) {
                        hotspotTitle.textContent = label;
                        hotspotContent.textContent = info;
                        hotspotInfo.classList.add('active');
                    }
                });
            });
            
            // 点击信息面板外部关闭
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.hotspot') && !e.target.closest('.hotspot-info')) {
                    const hotspotInfos = document.querySelectorAll('.hotspot-info');
                    hotspotInfos.forEach(info => {
                        info.classList.remove('active');
                    });
                }
            });
            
            // 点击信息面板关闭按钮关闭
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('close-hotspot-info')) {
                    const hotspotInfo = e.target.closest('.hotspot-info');
                    if (hotspotInfo) {
                        hotspotInfo.classList.remove('active');
                    }
                }
            });
            
            // 为所有全景容器添加拖拽功能
            const panoramaContainers = document.querySelectorAll('.panorama-container');
            panoramaContainers.forEach(container => {
                let isDragging = false;
                let startX = 0;
                let startTime = 0;
                let translateX = 0;
                
                container.addEventListener('mousedown', function(e) {
                    isDragging = true;
                    startX = e.clientX;
                    startTime = Date.now();
                    const currentTransform = getComputedStyle(container.querySelector('.panorama-image')).transform;
                    if (currentTransform !== 'none') {
                        const matrix = new DOMMatrix(currentTransform);
                        translateX = matrix.m41;
                    }
                    // 添加拖拽状态样式
                    container.style.cursor = 'grabbing';
                });
                
                container.addEventListener('mousemove', function(e) {
                    if (!isDragging) return;
                    
                    const deltaX = e.clientX - startX;
                    startX = e.clientX;
                    
                    // 更新全景图位置
                    panoramaMove(container.id.split('-')[1], deltaX);
                });
                
                container.addEventListener('mouseup', function(e) {
                    isDragging = false;
                    container.style.cursor = 'grab';
                    
                    // 添加惯性滚动效果
                    const endTime = Date.now();
                    const duration = endTime - startTime;
                    const deltaX = e.clientX - startX;
                    
                    if (duration < 200 && Math.abs(deltaX) > 10) {
                        // 计算惯性速度
                        const velocity = deltaX / duration;
                        const inertiaDistance = velocity * 100;
                        const routeId = container.id.split('-')[1];
                        
                        // 应用惯性滚动
                        let currentInertia = inertiaDistance;
                        const inertiaStep = inertiaDistance * 0.1;
                        
                        const inertiaTimer = setInterval(() => {
                            panoramaMove(routeId, currentInertia);
                            currentInertia *= 0.9;
                            
                            if (Math.abs(currentInertia) < 1) {
                                clearInterval(inertiaTimer);
                            }
                        }, 16);
                    }
                });
                
                container.addEventListener('mouseleave', function() {
                    isDragging = false;
                    container.style.cursor = 'grab';
                });
                
                // 触摸设备支持
                container.addEventListener('touchstart', function(e) {
                    const touch = e.touches[0];
                    isDragging = true;
                    startX = touch.clientX;
                    startTime = Date.now();
                    const currentTransform = getComputedStyle(container.querySelector('.panorama-image')).transform;
                    if (currentTransform !== 'none') {
                        const matrix = new DOMMatrix(currentTransform);
                        translateX = matrix.m41;
                    }
                });
                
                container.addEventListener('touchmove', function(e) {
                    if (!isDragging) return;
                    e.preventDefault();
                    const touch = e.touches[0];
                    const deltaX = touch.clientX - startX;
                    startX = touch.clientX;
                    const routeId = container.id.split('-')[1];
                    panoramaMove(routeId, deltaX);
                });
                
                container.addEventListener('touchend', function(e) {
                    isDragging = false;
                    
                    // 触摸设备惯性滚动
                    if (e.changedTouches.length > 0) {
                        const touch = e.changedTouches[0];
                        const endTime = Date.now();
                        const duration = endTime - startTime;
                        const deltaX = touch.clientX - startX;
                        
                        if (duration < 200 && Math.abs(deltaX) > 10) {
                            const velocity = deltaX / duration;
                            const inertiaDistance = velocity * 100;
                            const routeId = container.id.split('-')[1];
                            
                            let currentInertia = inertiaDistance;
                            const inertiaStep = inertiaDistance * 0.1;
                            
                            const inertiaTimer = setInterval(() => {
                                panoramaMove(routeId, currentInertia);
                                currentInertia *= 0.9;
                                
                                if (Math.abs(currentInertia) < 1) {
                                    clearInterval(inertiaTimer);
                                }
                            }, 16);
                        }
                    }
                });
            });
        }
        
        // 文化知识答题功能
        function initQuiz() {
            // 创建答题模态框
            const quizModal = document.createElement('div');
            quizModal.id = 'quiz-modal';
            quizModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                z-index: 2000;
                display: none;
                justify-content: center;
                align-items: center;
            `;
            
            quizModal.innerHTML = `
                <div style="background: white; padding: 40px; border-radius: 10px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
                    <h3 style="font-family: var(--f-title); font-size: 1.8rem; color: var(--c-red); margin-bottom: 30px; text-align: center;">文化知识小测试</h3>
                    <div id="quiz-content"></div>
                    <div id="quiz-result" style="margin-top: 20px; padding: 20px; background: var(--c-paper); border-radius: 8px; display: none;"></div>
                    <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px;">
                        <button id="quiz-submit" class="collect-all-btn" style="display: none;">提交答案</button>
                        <button id="quiz-close" class="collect-all-btn" style="background: var(--c-gray);">关闭</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(quizModal);
            
            // 关闭模态框
            document.getElementById('quiz-close').addEventListener('click', function() {
                quizModal.style.display = 'none';
            });
            
            // 文化知识题库 - 按景点分类
            const quizQuestionsBySpot = {
                'literature': [
                    {
                        question: '万松老人塔是为了纪念哪位历史人物而建？',
                        options: ['A. 万松行秀', 'B. 乾隆皇帝', 'C. 纳兰性德', 'D. 曹雪芹'],
                        correct: 0
                    },
                    {
                        question: '万松老人塔现位于北京西四南大街，其最初的建造年代是？',
                        options: ['A. 唐代', 'B. 金代', 'C. 元代', 'D. 明代'],
                        correct: 2
                    },
                    {
                        question: '万松老人塔曾因年久失修损毁，近代对其进行重修并保护的知名人物是？',
                        options: ['A. 梁思成', 'B. 朱启钤', 'C. 林徽因', 'D. 郭沫若'],
                        correct: 1
                    }
                ],
                'jiangnan': [
                    {
                        question: '紫竹院公园以竹景闻名，其建园的核心水系依托于北京哪一处古河道？',
                        options: ['A. 通惠河', 'B. 莲花河', 'C. 高粱河', 'D. 护城河'],
                        correct: 2
                    },
                    {
                        question: '紫竹院公园内的"福荫紫竹院"庙宇，最初是为了供奉哪位佛教人物而建？',
                        options: ['A. 观音菩萨', 'B. 文殊菩萨', 'C. 普贤菩萨', 'D. 地藏菩萨'],
                        correct: 0
                    },
                    {
                        question: '紫竹院公园的名字由来，与以下哪一历史背景相关？',
                        options: ['A. 清代宫廷种紫竹祈福', 'B. 明代寺庙旁紫竹成林', 'C. 元代文人在此种竹题诗', 'D. 辽代皇家园林植竹造景'],
                        correct: 1
                    }
                ],
                'ditan': [
                    {
                        question: '地坛公园是明清帝王祭祀"皇地祇神"的场所，其与天坛南北对应，地坛祭祀的核心是祈求什么？',
                        options: ['A. 五谷丰登、土地安宁', 'B. 风调雨顺、国运昌隆', 'C. 子孙绵延、皇室兴旺', 'D. 消灾避祸、百姓安康'],
                        correct: 0
                    },
                    {
                        question: '地坛公园内的核心建筑方泽坛，其台面铺砌的石块数遵循的是哪种古代数字理念？',
                        options: ['A. 阴阳五行', 'B. 天圆地方', 'C. 九五之尊', 'D. 四象八卦'],
                        correct: 1
                    },
                    {
                        question: '史铁生的散文名篇《我与地坛》中，他常去地坛的核心原因是？',
                        options: ['A. 地坛环境清幽，适合写作创作', 'B. 遭遇人生挫折后，寻求心灵慰藉', 'C. 家住地坛附近，日常散步消遣', 'D. 地坛藏有书籍，便于查阅资料'],
                        correct: 1
                    }
                ]
            };
            
            // 显示答题
            window.showQuiz = function(spotId = 'literature') {
                const quizContent = document.getElementById('quiz-content');
                const quizResult = document.getElementById('quiz-result');
                const quizSubmit = document.getElementById('quiz-submit');
                
                // 重置答题状态
                quizResult.style.display = 'none';
                quizSubmit.style.display = 'block';
                
                // 获取对应景点的题目
                const quizQuestions = quizQuestionsBySpot[spotId] || quizQuestionsBySpot['literature'];
                
                // 生成题目HTML
                let quizHTML = '';
                quizQuestions.forEach((q, index) => {
                    quizHTML += `
                        <div style="margin-bottom: 25px;">
                            <p style="font-size: 1.1rem; margin-bottom: 15px; font-weight: bold;">${index + 1}. ${q.question}</p>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                ${q.options.map((option, optIndex) => `
                                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; border-radius: 4px; transition: background-color 0.2s;">
                                        <input type="radio" name="quiz-${index}" value="${optIndex}" style="accent-color: var(--c-red);">
                                        <span>${option}</span>
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                    `;
                });
                
                quizContent.innerHTML = quizHTML;
                quizModal.style.display = 'flex';
                
                // 存储当前景点ID，用于提交答案时使用
                quizModal.dataset.currentSpot = spotId;
            };
            
            // 提交答案
            document.getElementById('quiz-submit').addEventListener('click', function() {
                const spotId = quizModal.dataset.currentSpot || 'literature';
                const quizQuestions = quizQuestionsBySpot[spotId] || quizQuestionsBySpot['literature'];
                
                let correctCount = 0;
                let wrongAnswers = [];
                
                quizQuestions.forEach((q, index) => {
                    const selectedOption = document.querySelector(`input[name="quiz-${index}"]:checked`);
                    const selectedValue = selectedOption ? parseInt(selectedOption.value) : -1;
                    
                    if (selectedValue === q.correct) {
                        correctCount++;
                    } else {
                        wrongAnswers.push({
                            index: index,
                            question: q.question,
                            selectedAnswer: selectedValue >= 0 ? q.options[selectedValue] : '未作答',
                            correctAnswer: q.options[q.correct]
                        });
                    }
                });
                
                // 显示结果
                const quizResult = document.getElementById('quiz-result');
                const quizSubmit = document.getElementById('quiz-submit');
                
                let resultHTML = `
                    <h4 style="color: var(--c-red); margin-bottom: 15px;">测试结果</h4>
                    <p>你答对了 ${correctCount}/${quizQuestions.length} 道题！</p>
                    ${correctCount === quizQuestions.length ? 
                        '<p style="color: var(--c-gold);">🎉 恭喜你全部答对！</p>' : 
                        '<p style="color: var(--c-gray);">继续加油，了解更多北平文化！</p>'
                    }
                `;
                
                // 添加错误题目及正确答案
                if (wrongAnswers.length > 0) {
                    resultHTML += `
                        <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                            <h5 style="color: var(--c-red); margin-bottom: 15px;">错误题目及正确答案：</h5>
                            <ul style="list-style: none; padding: 0; margin: 0;">
                                ${wrongAnswers.map(item => `
                                    <li style="margin-bottom: 15px; padding: 10px; background: #f9f9f9; border-radius: 4px;">
                                        <p style="margin-bottom: 8px;"><strong>${item.index + 1}. ${item.question}</strong></p>
                                        <p style="margin: 4px 0;">你的答案：<span style="color: #999;">${item.selectedAnswer}</span></p>
                                        <p style="margin: 4px 0;">正确答案：<span style="color: var(--c-red); font-weight: bold;">${item.correctAnswer}</span></p>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                    `;
                }
                
                quizResult.innerHTML = resultHTML;
                quizResult.style.display = 'block';
                quizSubmit.style.display = 'none';
                
                // 如果全部答对，收集特殊印章
                if (correctCount === quizQuestions.length) {
                    collectStamp('quiz-master');
                }
            });
            
            // 添加答题按钮到路线详情
                    const addQuizButtons = () => {
                        const routeDetails = document.querySelectorAll('.route-details-section');
                        routeDetails.forEach((detail, index) => {
                            // 检查是否已经添加了答题按钮
                            if (!detail.querySelector('.quiz-btn')) {
                                const viewBtn = detail.querySelector('.view-btn');
                                if (viewBtn) {
                                    const quizBtn = document.createElement('button');
                                    quizBtn.className = 'view-btn quiz-btn';
                                    quizBtn.style.marginLeft = '15px';
                                    quizBtn.style.background = 'var(--c-gold)';
                                    quizBtn.textContent = '文化知识小测试';
                                    
                                    // 根据索引传递正确的景点ID
                                    const spotIds = ['literature', 'jiangnan', 'ditan'];
                                    const spotId = spotIds[index] || 'literature';
                                    quizBtn.onclick = function() {
                                        showQuiz(spotId);
                                    };
                                    
                                    viewBtn.parentNode.insertBefore(quizBtn, viewBtn.nextSibling);
                                }
                            }
                        });
                    };
            
            // 初始化时添加答题按钮
            addQuizButtons();
        }
        
        // 升级社交分享功能
        function initSocialSharing() {
            // 为分享按钮添加功能
            const shareBtn = document.querySelector('.share-btn');
            if (shareBtn) {
                shareBtn.onclick = function() {
                    // 创建分享选项
                    const shareOptions = [
                        { name: '微信朋友圈', icon: '📱', action: () => alert('微信朋友圈分享功能已启用') },
                        { name: '微博', icon: '🐦', action: () => alert('微博分享功能已启用') },
                        { name: '生成海报', icon: '📸', action: () => generatePoster() },
                        { name: '复制链接', icon: '🔗', action: () => copyShareLink() }
                    ];
                    
                    // 创建分享面板
                    const sharePanel = document.createElement('div');
                    sharePanel.style.cssText = `
                        position: fixed;
                        bottom: 0;
                        left: 0;
                        width: 100%;
                        background: white;
                        padding: 30px;
                        box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
                        z-index: 2000;
                        border-radius: 20px 20px 0 0;
                    `;
                    
                    sharePanel.innerHTML = `
                        <div style="display: flex; flex-direction: column; gap: 20px;">
                            <h3 style="font-family: var(--f-title); font-size: 1.5rem; color: var(--c-red); text-align: center;">分享城市记忆</h3>
                            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px;">
                                ${shareOptions.map(opt => `
                                    <div style="display: flex; flex-direction: column; align-items: center; gap: 10px; cursor: pointer; padding: 20px; border-radius: 10px; transition: background-color 0.2s;">
                                        <div style="font-size: 2.5rem;">${opt.icon}</div>
                                        <span style="font-size: 0.9rem;">${opt.name}</span>
                                    </div>
                                `).join('')}
                            </div>
                            <button id="share-close" class="collect-all-btn" style="margin: 0 auto; display: block;">关闭</button>
                        </div>
                    `;
                    
                    document.body.appendChild(sharePanel);
                    
                    // 添加事件监听
                    const shareItems = sharePanel.querySelectorAll('div > div');
                    shareItems.forEach((item, index) => {
                        item.addEventListener('click', shareOptions[index].action);
                        item.addEventListener('mouseenter', function() {
                            this.style.backgroundColor = 'var(--c-paper)';
                        });
                        item.addEventListener('mouseleave', function() {
                            this.style.backgroundColor = '';
                        });
                    });
                    
                    // 关闭分享面板
                    document.getElementById('share-close').addEventListener('click', function() {
                        sharePanel.remove();
                    });
                };
            }
        }
        
        // 生成分享海报
        function generatePoster() {
            alert('📸 海报生成功能已启用！\n海报将包含您的集章进度和当前路线信息。');
        }
        
        // 复制分享链接
        function copyShareLink() {
            navigator.clipboard.writeText(window.location.href).then(() => {
                alert('🔗 分享链接已复制到剪贴板！');
            }).catch(err => {
                alert('复制失败，请手动复制链接');
            });
        }
    </script>
<script>
    // --- AI语言大模型功能 (修复版) --- //

    // 1. 配置信息 (智谱清言 API)
    const API_KEY = 'dbeee851b40b4654910afb61853d9b5d.Pdly9gA9ZsIHIsod'; 
    const API_URL = 'https://open.bigmodel.cn/api/paas/v4/chat/completions';

    // 2. 获取 DOM 元素
    const aiBtn = document.getElementById('ai-btn');
    const aiChat = document.getElementById('ai-chat');
    const chatMessages = document.getElementById('chat-messages');
    const chatInput = document.getElementById('chat-input');
    const sendBtn = document.getElementById('send-btn');
    
    // 维护对话历史
    let conversationHistory = [];

    // 3. 切换聊天窗口显示/隐藏
    function toggleAIChat() {
        // 检查元素是否存在
        if (!aiChat) return;
        
        const isHidden = aiChat.style.display === 'none' || aiChat.style.display === '';
        aiChat.style.display = isHidden ? 'flex' : 'none';
        if (isHidden) {
            // 打开时自动聚焦输入框
            setTimeout(() => {
                if(chatInput) chatInput.focus();
            }, 100);
        }
    }

    // 4. 添加消息到界面
    function addMessage(text, isUser = false, isLoading = false) {
        if (!chatMessages) return;

        const messageDiv = document.createElement('div');
        
        // 设置样式
        let bgColor = isUser ? 'var(--c-red)' : 'var(--c-paper)';
        let textColor = isUser ? 'white' : 'var(--c-ink)';
        let alignSelf = isUser ? 'flex-end' : 'flex-start';
        let borderRadius = isUser ? '18px 18px 5px 18px' : '18px 18px 18px 5px';

        // 加载状态样式
        if (isLoading) {
            messageDiv.id = 'ai-loading';
            text = '⚪ ⚪ ⚪'; // 思考动画占位
            bgColor = 'transparent';
            textColor = '#999';
        }

        messageDiv.style.cssText = `
            padding: 10px 15px;
            border-radius: ${borderRadius};
            align-self: ${alignSelf};
            max-width: 80%;
            background: ${bgColor};
            color: ${textColor};
            margin-bottom: 10px;
            word-wrap: break-word;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            line-height: 1.5;
            text-align: left; 
        `;

        // 简单处理加粗
        if (!isUser && !isLoading) {
            text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        }

        messageDiv.innerHTML = `<p style="margin: 0;">${text}</p>`;
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // 5. 发送消息逻辑
    async function sendMessage() {
        const userMessage = chatInput.value.trim();
        if (!userMessage) return;

        // 显示用户消息
        addMessage(userMessage, true);
        chatInput.value = '';
        chatInput.disabled = true;

        // 显示思考中
        addMessage('', false, true);

        try {
            // 构建请求数据
            const payload = {
                model: "glm-4-flash",
                messages: [
                    { role: 'system', content: '你叫“北平风物君”，是“北平风物记”网站的智能导游。请用优雅、文学性的语言回答关于北京文化、历史和旅游的问题。' },
                    ...conversationHistory,
                    { role: 'user', content: userMessage }
                ],
                stream: false
            };

            const response = await fetch(API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${API_KEY}`
                },
                body: JSON.stringify(payload)
            });

            const data = await response.json();

            // 移除加载动画
            const loadingDiv = document.getElementById('ai-loading');
            if (loadingDiv) loadingDiv.remove();

            // 处理回复
            if (data.choices && data.choices.length > 0) {
                const aiReply = data.choices[0].message.content;
                addMessage(aiReply, false);
                
                // 更新历史记录
                conversationHistory.push({ role: "user", content: userMessage });
                conversationHistory.push({ role: "assistant", content: aiReply });
                
                // 限制历史记录长度
                if(conversationHistory.length > 6) conversationHistory = conversationHistory.slice(-6);
            } else {
                addMessage("风物君似乎走神了，请稍后再试。", false);
            }

        } catch (error) {
            console.error("API Error:", error);
            const loadingDiv = document.getElementById('ai-loading');
            if (loadingDiv) loadingDiv.remove();
            addMessage("网络连接似乎断了，请检查网络设置。", false);
        } finally {
            chatInput.disabled = false;
            chatInput.focus();
        }
    }

    // 6. 绑定事件监听 (确保 DOM 加载后执行)
    document.addEventListener('DOMContentLoaded', () => {
        // 绑定按钮点击
        if (aiBtn) {
            aiBtn.onclick = toggleAIChat; // 显式绑定
        }

        if (sendBtn) {
            sendBtn.onclick = sendMessage;
        }

        if (chatInput) {
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });
        }

        // 点击外部关闭窗口
        document.addEventListener('click', (e) => {
            if (aiChat && aiBtn && aiChat.style.display === 'flex' && !aiChat.contains(e.target) && !aiBtn.contains(e.target)) {
                aiChat.style.display = 'none';
            }
        });
    });
</script>

    <!-- 夜间模式切换逻辑 -->
    <script>
        // 夜间模式切换逻辑
        document.addEventListener('DOMContentLoaded', function() {
            const themeToggle = document.getElementById('theme-toggle');
            const htmlElement = document.documentElement;
            
            // 从本地存储获取主题设置
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                htmlElement.setAttribute('data-theme', savedTheme);
                // 更新切换按钮图标
                updateThemeIcon(savedTheme);
            }
            
            // 主题切换事件
            themeToggle.addEventListener('click', function() {
                const currentTheme = htmlElement.getAttribute('data-theme');
                let newTheme;
                
                if (currentTheme === 'dark') {
                    newTheme = 'light';
                } else {
                    newTheme = 'dark';
                }
                
                // 切换主题
                htmlElement.setAttribute('data-theme', newTheme);
                
                // 保存到本地存储
                localStorage.setItem('theme', newTheme);
                
                // 更新切换按钮图标
                updateThemeIcon(newTheme);
            });
            
            // 更新主题切换按钮图标
            function updateThemeIcon(theme) {
                if (theme === 'dark') {
                    themeToggle.textContent = '☀️';
                } else {
                    themeToggle.textContent = '🌙';
                }
            }
        });
        
        // 滚动进度指示器和返回顶部按钮逻辑
        document.addEventListener('DOMContentLoaded', function() {
            // 滚动进度指示器
            const scrollProgress = document.querySelector('.scroll-progress');
            
            // 返回顶部按钮
            const backToTop = document.getElementById('back-to-top');
            
            // 监听滚动事件
            window.addEventListener('scroll', function() {
                // 计算滚动进度
                const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
                const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
                const scrolled = (winScroll / height) * 100;
                
                // 更新进度条宽度
                scrollProgress.style.width = scrolled + '%';
                
                // 控制返回顶部按钮显示/隐藏
                if (winScroll > 300) {
                    backToTop.classList.add('visible');
                } else {
                    backToTop.classList.remove('visible');
                }
            });
            
            // 返回顶部按钮点击事件
            backToTop.addEventListener('click', function() {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
        });
    </script>
</body>
</html>
